"use strict";var app=angular.module("designApp",["ngRoute","ngCookies","ngResource","ngSanitize","ngTouch","ngAnimate","ui.uploader","frame","bigUi"]);app.run(["$rootScope","global","$http","appHeader",function(a,b,c,d){a.prefix="test_",a["default"]={localStorage:!0,autoSaveLocal:!0,init:!0,debug:!1,debugType:"log"},b.getData({api:b.api.baseGet,onSuccess:function(a){"0"==a.code&&d.setBaseInfo(a.data)},onError:function(a){}})}]),app.config(["$routeProvider","$locationProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/style-setting",{templateUrl:"views/style-setting.html",controller:"StyleSetCtrl"}).otherwise({redirectTo:"/"})}]),app.service("userStateInterceptor",["$location","$q","$rootScope","loading",function(a,b,c,d){var e={request:function(a){return"undefined"!=typeof a.data&&"undefined"!=typeof a.data.unload||d.show(),a},response:function(a){return d.hide(),a},requestError:function(a){return d.hide(),console.warn(a),b.reject(a)},responseError:function(a){return d.hide(),console.warn(a),b.reject(a)}};return e}]),app.config(["$httpProvider",function(a){a.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded;charset=utf-8",a.defaults.headers.cookies=document.cookie,a.interceptors.push("userStateInterceptor");var b=function(a){var c,d,e,f,g,h,i,j="";for(c in a)if(d=a[c],d instanceof Array)for(i=0;i<d.length;++i)g=d[i],e=c+"["+i+"]",h={},h[e]=g,j+=b(h)+"&";else if(d instanceof Object)for(f in d)g=d[f],e=c+"["+f+"]",h={},h[e]=g,j+=b(h)+"&";else void 0!==d&&null!==d&&(j+=encodeURIComponent(c)+"="+encodeURIComponent(d)+"&");return j.length?j.substr(0,j.length-1):j};a.defaults.transformRequest=[function(a){return angular.isObject(a)&&"[object File]"!==String(a)?b(a):a}]}]);var bigUi=angular.module("bigUi",[]),frame=angular.module("frame",[]);app.service("$console",["$rootScope","$log",function(a,b){for(var c=void 0==a["default"].debug?!0:a["default"].debug,d=void 0==a["default"].debugType?"console":a["default"].debugType,e=this,f={clear:function(){console.clear()}},g=["debug","log","error","warn"],h=0;h<g.length;h++){var i=g[h],g=function(a){return console.log(i),c&&"log"==d&&void 0!==b[i]?b[i](a):console[i](a)};f[i]=g}for(var i in f)e[i]=f[i]}]),app.service("localStorage",["$rootScope",function(a){window.localStorage||(a.localStorge=!1);var b=window.localStorage,c=this;c.prefix=a.prefix||"bigApp_",c.setItem=function(a,d){var e=c.prefix+a,f=d;"object"==typeof d&&(f=JSON.stringify(d)),b.setItem(e,f)},c.getItem=function(a){var d=c.prefix+a,e=JSON.parse(b.getItem(d));return e},c.removeItem=function(a){var d=c.prefix+a;return b.removeItem(d)},c.clear=function(){var a=b;$.each(a,function(a){console.log(a.indexOf(c.prefix)),0==a.indexOf(c.prefix)&&b.removeItem(a)})}}]),app.service("designSetting",["$rootScope","$location","globalTips","$http","$timeout","uiUploader","$q","$window","global",function(a,b,c,d,e,f,g,h,i){function j(){angular.forEach(k.views.outer_views,function(a){a.id>k.maxViewTypeId&&(k.maxViewTypeId=parseInt(a.id))}),k.viewSelectList=angular.extend({},k.views.inner_views,k.views.outer_views)}var k=this,l={activeViewType:0,guided:!0,module:{viewModule:{name:"viewModule",src:"views/view-module.html"},viewForum:{name:"viewForum",src:"views/view-forum.html"},setMain:{name:"setMain",src:"views/base-setting.html"}},btn_list:[{id:"1",value:"自定义tab"},{id:"2",value:"首页发帖"},{id:"3",value:"我的"},{id:"4",value:"消息"},{id:"5",value:"版块"}],tab_list:[{id:"1",value:"单页面"},{id:"2",value:"导航页面"}],posts_type:[{id:"1",value:"站外链接"},{id:"2",value:"帖子链接"},{id:"3",value:"版块链接"},{id:"4",value:"文章链接"},{id:"5",value:"频道链接"}],posts_id_type:[{id:"1",value:"文章ID"},{id:"2",value:"帖子ID"},{id:"3",value:"频道ID"},{id:"4",value:"版块ID"}],posts_id_type_simple:[{id:"1",value:"文章ID"},{id:"2",value:"帖子ID"}],views:{},views_data:{},theme_icon_info:{prefix:"",data:[{type:1,total:13},{type:2,total:5},{type:3,total:29}]},nav_icon_info:{prefix:"nav_",data:[{type:1,total:14}]},theme_icon:{}};k.maxViewTypeId=10,k.init=function(a){d({method:"get",url:i.api.global,cache:!0}).then(function(b){$.extend(k,b.data),j(),a.call(null)},function(b){a.call(null),alert("初始化失败，请检查您的网络")})},k.setMain=function(b){"undefined"!=typeof b&&($.extend(k.views,b),j()),a.$broadcast("set-main")},k.getViewData=function(a){var b=g.defer();return void 0==k.views_data[a]?i.getData({api:i.api.getView,data:{vid:a},onSuccess:function(d){0==d.code?(k.views_data[a]=d.data,b.resolve(d.data)):void 0!=d.code?c.push({txt:d.msg,type:"warn"}):c.push({txt:"出错了，请检查您的网络是否通畅后，刷新重试",type:"warn"})},onError:function(a){b.reject(a)}}):b.resolve(k.views_data[a]),b.promise},k.dataModule={baseTree:{name:"",id:0,title:"",tab_type:"1",use_wap_name:"1",home_page:[{type:"1",sort:"1",enable:"1",setting:[]},{type:"2",sort:"2",enable:"1",setting:[]},{type:"3",sort:"3",enable:"1",setting:[]},{type:"4",sort:"4",enable:"1",setting:{type:"1",data_src_cfg:{type:"2",content_setting:[],recomm_setting:[{flag:"1",order:"0",module:"最新帖子",title:"最新",display_id:"",forbidden_id:""},{flag:"1",order:"1",module:"热门帖子",title:"热门",display_id:"",forbidden_id:""},{flag:"1",order:"1",module:"精华帖子",title:"精华",display_id:"",forbidden_id:""}]}}}],navi_page:{selected:"1",navi:[],wap_page:"http://"},title_cfg:[{name:"",icon_type:"",view_type:"1"},{name:"",icon_type:"",view_type:"1"}],wap_page:"http://"},button_cfg:{name:"",icon_type:"",button_type:"",view_type:""},title_cfg:{name:"",icon_type:"",view_type:"1"},navi_page:{flag:"1",order:"0",navi_name:"",id:"1",navi_setting:{tab_type:"1",home_page:[{type:"1",sort:"1",enable:"1",setting:[]},{type:"2",sort:"2",enable:"1",setting:[]},{type:"3",sort:"3",enable:"1",setting:[]},{type:"4",sort:"4",enable:"1",setting:{type:"1",data_src_cfg:{type:"1",content_setting:[],recomm_setting:[{flag:"1",order:"0",module:"最新帖子",title:"最新",display_id:"",forbidden_id:""},{flag:"1",order:"1",module:"热门帖子",title:"热门",display_id:"",forbidden_id:""},{flag:"1",order:"2",module:"精华帖子",title:"精华",display_id:"",forbidden_id:""}]}}}],wap_page:"http://"}},home_page:[{id:"1",title:"",pic:"",url:"http://",type:"1",order:"1",flag:"1",desc:""},{id:"1",title:"",pic:"",url:"http://",type:"1",order:"1",flag:"1",desc:""},{id:"1",title:"",pic:"",url:"http://",type:"1",order:"1",flag:"1",desc:""},{order:"1",id:"",type:"1"}]},angular.extend(k,l)}]);var v_test={method_base_path:"http://192.168.180.93:8080/discuz",banner_image_s:"http://192.168.180.93:8080/discuz/plugin.php?id=bigapp:uploadpic&key=banner_image_s",func_image_s:"http://192.168.180.93:8080/discuz/plugin.php?id=bigapp:uploadpic&key=func_image_s",func_forum_image_s:"http://192.168.180.93:8080/discuz/plugin.php?id=bigapp:uploadpic&key=func_forum_image_s",imageSize:{icon_image_s:{allow_postfix:["image/png"],need_compress:0,width:1024,height:1024,size:1048576},startup_image_s:{allow_postfix:["image/png"],width:1242,height:2208,size:1048576},banner_image_s:{width:750,height:342,size:1048576},func_image_s:{width:96,height:96,size:1048576},func_forum_image_s:{width:88,height:88,size:1048576},mobile_app_image_s:{width:249,height:433,size:1048576}}};!function(){app.service("global",["$rootScope","$location","loading","$http","$timeout","uiUploader","$log","$window","appHeader",function(a,b,c,d,e,f,g,h,i){var j=this,k="undefined"!=typeof v?v:v_test,l={baseHost:k.method_base_path||"http://192.168.180.93:8080/discuz",staticBasePath:k.image_base_path||"",uploadKeyArr:["banner_image_s","func_image_s","func_forum_image_s"],imageSize:k.imageSize||"",api:{global:"/plugin.php?id=bigapp:design&method=global1",baseGet:"/plugin.php?id=bigapp:designmenu&method=get",skeleton:"/plugin.php?id=bigapp:design&method=skeleton",page:"/plugin.php?id=bigapp:design&method=page",save:"/plugin.php?id=bigapp:design&method=save",apply:"/plugin.php?id=bigapp:design&method=apply",getView:"/plugin.php?id=bigapp:view&method=get",saveView:"/plugin.php?id=bigapp:view&method=save",deleteView:"/plugin.php?id=bigapp:view&method=delete",roback:"/plugin.php?id=bigapp:design&method=roback",getStyleStting:"/plugin.php?id=bigapp:settings&method=get",saveStyleStting:"/plugin.php?id=bigapp:settings&method=save",upload_img:"/plugin.php?id=bigapp:uploadpic"}};$.each(l.api,function(a,b){l.api[a]=l.baseHost+b}),$.extend(j,l),j.getData=function(a){function b(a){"function"==typeof e.onSuccess&&e.onSuccess.apply(e,[a.data])}function c(a){g.error("接口-"+e.api+"-请求失败"),"function"==typeof e.onError&&e.onError.apply(e,[a.data])}var e={api:"",data:"",onSuccess:null,onError:null};$.extend(e,a),d({method:"POST",url:e.api,data:e.data,cache:!0}).then(function(a){b(a)},function(a){c(a)})},j.getStrLen=function(a){for(var b=a.length,c=0;c<a.length;c++)/^[\u4e00-\u9fa5]*$/.test(a[c])&&b++;return b},j.getId=function(a){if(void 0!=a){var b=a.split(","),c=[];return $.each(b,function(a,b){""!=b&&c.push(b)}),c}},j.imgFileUpload=function(a,b,c,d,e){function h(a,b){if(void 0==b||0==b.length)return!0;var c=a.name,d=c.split(".");d=d[d.length-1];var e=!1;return $.each(b,function(a,b){d.toLowerCase()==b&&(e=!0)}),e}function i(a,b){f.startUpload({url:j.api.upload_img+"&key="+a,key:a,concurrency:1,onProgress:function(a){g.info(a.name+"="+a.humanSize),c.$apply()},onCompleted:function(a,d){g.info(a+"response"+d);var f=JSON.parse(d);0==f.error_code?(b.apply(a,[f.data]),c.$apply()):(e.apply(a,[f]),c.$apply())},onCompletedAll:function(a){}})}var k={ele:{},typeArr:[]};$.extend(k,b),k.ele=document.getElementById(a),k.ele.addEventListener("change",function(a){var b=a.target.files;if(f.removeAll(),f.addFiles(b),k.ele.value=null,k.files=f.getFiles(),h(k.files[0],k.typeArr))i(k.key,d,e);else{var g=k.typeArr.join(",");e.call(this,{error_msg:"文件格式不正确，该功能支持"+g+"格式。"})}c.$apply()})},j.base64={base64EncodeChars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",base64DecodeChars:new Array(-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1),encode:function(a){var b,c,d,e,f,g;for(d=a.length,c=0,b="";d>c;){if(e=255&a.charCodeAt(c++),c==d){b+=this.base64EncodeChars.charAt(e>>2),b+=this.base64EncodeChars.charAt((3&e)<<4),b+="==";break}if(f=a.charCodeAt(c++),c==d){b+=this.base64EncodeChars.charAt(e>>2),b+=this.base64EncodeChars.charAt((3&e)<<4|(240&f)>>4),b+=this.base64EncodeChars.charAt((15&f)<<2),b+="=";break}g=a.charCodeAt(c++),b+=this.base64EncodeChars.charAt(e>>2),b+=this.base64EncodeChars.charAt((3&e)<<4|(240&f)>>4),b+=this.base64EncodeChars.charAt((15&f)<<2|(192&g)>>6),b+=this.base64EncodeChars.charAt(63&g)}return b},decode:function(a){var b,c,d,e,f,g,h;for(g=a.length,f=0,h="";g>f;){do b=this.base64DecodeChars[255&a.charCodeAt(f++)];while(g>f&&-1==b);if(-1==b)break;do c=this.base64DecodeChars[255&a.charCodeAt(f++)];while(g>f&&-1==c);if(-1==c)break;h+=String.fromCharCode(b<<2|(48&c)>>4);do{if(d=255&a.charCodeAt(f++),61==d)return h;d=this.base64DecodeChars[d]}while(g>f&&-1==d);if(-1==d)break;h+=String.fromCharCode((15&c)<<4|(60&d)>>2);do{if(e=255&a.charCodeAt(f++),61==e)return h;e=this.base64DecodeChars[e]}while(g>f&&-1==e);if(-1==e)break;h+=String.fromCharCode((3&d)<<6|e)}return h},utf16to8:function(a){var b,c,d,e;for(b="",d=a.length,c=0;d>c;c++)e=a.charCodeAt(c),e>=1&&127>=e?b+=a.charAt(c):e>2047?(b+=String.fromCharCode(224|e>>12&15),b+=String.fromCharCode(128|e>>6&63),b+=String.fromCharCode(128|e>>0&63)):(b+=String.fromCharCode(192|e>>6&31),b+=String.fromCharCode(128|e>>0&63));return b},utf8to16:function(a){var b,c,d,e,f,g;for(b="",d=a.length,c=0;d>c;)switch(e=a.charCodeAt(c++),e>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:b+=a.charAt(c-1);break;case 12:case 13:f=a.charCodeAt(c++),b+=String.fromCharCode((31&e)<<6|63&f);break;case 14:f=a.charCodeAt(c++),g=a.charCodeAt(c++),b+=String.fromCharCode((15&e)<<12|(63&f)<<6|(63&g)<<0)}return b}}}])}();var test_global={btn_list:[{id:"1",value:"自定义tab"},{id:"2",value:"版块"},{id:"3",value:"首页发帖"},{id:"4",value:"消息"},{id:"5",value:"我的"}],tab_list:[{id:"1",value:"单页面"},{id:"2",value:"导航页面"},{id:"3",value:"WAP页面"}],views:{inner_views:{2:{name:"论坛",id:2},3:{name:"发帖",id:3},4:{name:"站内信",id:4},5:{name:"我的",id:5},6:{name:"搜索",id:6},7:{name:"扫一扫",id:7}},outer_views:{11:{tab_type:"1",home_page:[{type:"1",sort:"1",enable:"1",setting:[{id:"1",title:"bigapp1",pic:"http://mobfile.youzu.com/Uploads_image/25/b/c/1/bc1ac812cc7927213d65149df160cca7.png?_v=1446175390",url:"http://192.168.180.93:8080/discuz/forum.php?mod=forumdisplay&fid=2",type:"3",pid:"2",order:"1",flag:"1",desc:""},{id:"2",title:"bigapp2",pic:"http://mobfile.youzu.com/Uploads_image/27/5/4/f/54f71d9ccc1d403ec90ffe9913bb967c.png?_v=1446175390",url:"http://bigapp.mob.com/",type:"1",pid:"0",order:"2",flag:"1",desc:""},{id:"3",title:"bigapp3",pic:"http://mobfile.youzu.com/Uploads_image/33/6/0/4/6041a6f1ecb9c375083ce6ce606d6bfa.png?_v=1446175390",url:"http://bigapp.mob.com/",type:"1",pid:"0",order:"3",flag:"1",desc:""},{id:"4",title:"bigapp4",pic:"http://mobfile.youzu.com/Uploads_image/22/d/a/b/dabd4a13566464ac912d962b5201329c.png?_v=1446175390",url:"http://bigapp.mob.com/",type:"1",pid:"0",order:"4",flag:"1",desc:""},{id:"5",title:"bigapp5",pic:"http://mobfile.youzu.com/Uploads_image/28/5/5/9/5594b24cadf974af82ddb25892e9ac3c.png?_v=1446175390",url:"http://bigapp.mob.com/",type:"1",pid:"0",order:"5",flag:"1",desc:""},{id:"6",title:"bigapp6",pic:"http://mobfile.youzu.com/Uploads_image/32/d/7/b/d7be3c520b736af8fd6817ac6a89ebc4.png?_v=1446175390",url:"http://bigapp.mob.com/",type:"1",pid:"0",order:"6",flag:"1",desc:""}]},{type:"2",sort:"2",enable:"1",setting:[{id:"1",title:"bigapp1",pic:"http://mobfile.youzu.com/Uploads_image/1/a/2/d/a2d48037df9c1dbeacdb3232ca2197b3.png?_v=1446175390",url:"http://bigapp.mob.com/",type:"1",pid:"0",order:"1",flag:"1",desc:""},{id:"2",title:"bigapp2",pic:"http://mobfile.youzu.com/Uploads_image/1/d/2/c/d2c5d626b2e2dbb705b277f92903a767.png?_v=1446175390",url:"http://bigapp.mob.com/",type:"1",pid:"0",order:"2",flag:"1",desc:""},{id:"3",title:"bigapp3",pic:"http://mobfile.youzu.com/Uploads_image/1/c/5/d/c5d514e2ff2a7d4c58ceed840e0253f0.png?_v=1446175390",url:"http://bigapp.mob.com/",type:"1",pid:"0",order:"5",flag:"1",desc:""}]},{type:"3",sort:"3",enable:"1",setting:[{id:"4",title:"bigapp4",pic:"http://mobfile.youzu.com/Uploads_image/1/d/6/4/d6443b9c58e64aa3d640d269b23d444f.png?_v=1446175390",url:"http://bigapp.mob.com/",type:"1",pid:"0",order:"4",flag:"1",desc:"bigapp"},{id:"5",title:"bigapp5",pic:"http://mobfile.youzu.com/Uploads_image/2/2/6/1/2610b00cd55a65d3580037c910f37e06.png?_v=1446175390",url:"http://bigapp.mob.com/",type:"1",pid:"3",order:"3",flag:"1",desc:"bigapp"},{id:"6",title:"bigapp6",pic:"http://mobfile.youzu.com/Uploads_image/2/3/2/7/327bef8b10441329007fb9dcc956be9f.png?_v=1446175390",url:"http://bigapp.mob.com/",type:"1",pid:"3",order:"3",flag:"1",desc:"bigapp"},{id:"7",title:"bigapp7",pic:"http://mobfile.youzu.com/Uploads_image/2/b/1/8/b184780602b05fd6df357984890b11f2.png?_v=1446175390",url:"http://bigapp.mob.com/",type:"1",pid:"3",order:"3",flag:"1",desc:"bigapp"},{id:"8",title:"bigapp8",pic:"http://mobfile.youzu.com/Uploads_image/2/c/a/1/ca107b8c4d6edd90271c652148aeb1e7.png?_v=1446175390",url:"http://bigapp.mob.com/",type:"1",pid:"1",order:"3",flag:"1",desc:"bigapp"},{id:"9",title:"bigapp9",pic:"http://mobfile.youzu.com/Uploads_image/2/7/6/0/76059c5c50fc81dcc32b9c6fbd722577.png?_v=1446175390",url:"http://bigapp.mob.com/",type:"1",pid:"1",order:"3",flag:"1",desc:"bigapp"}]},{type:"4",sort:"4",enable:"1",setting:{type:"1",data_src_cfg:{type:"2",content_setting:[{order:"1",id:"1,2,3",type:"1"},{order:"2",id:"2,3",type:"2"}],recomm_setting:[{flag:"1",order:"0",module:"最新帖子",title:"最新",display_id:"",forbidden_id:""},{flag:"1",order:"1",module:"热门帖子",title:"热门",display_id:"",forbidden_id:""},{flag:"1",order:"2",module:"精华帖子",title:"精华",display_id:"",forbidden_id:""}]}}}],navi_page:{selected:"0",navi:[]},wap_page:"",name:"首页",id:11,title:"",title_cfg:[{name:"头部按钮",icon_type:"1_1",view_type:"11"},{name:"头部按钮2",icon_type:"1_1",view_type:"2"}]}}}};bigUi.filter("viewType",[function(){return function(a){var b={};for(var c in a)2!=a[c].ctrl_flag&&(b[c]=a[c]);return b}}]),bigUi.service("loading",["$rootScope",function(a){var b=this;this.layer=0;var c=[];this.show=function(b){this.layer++,c.push(b),a.$broadcast("loading-add")},this.hide=function(){b.layer--,c.pop(),a.$broadcast("loading-remove")},this.clear=function(){this.layer=0,c=[],a.$broadcast("loading-remove")},this._doClick=function(){var a=c.pop();"function"==typeof a&&(c.push(a),a())}}]).directive("loading",["loading","$timeout",function(a){return{replace:!0,scope:!0,template:'<div class="loading"><div class="layer"></div><div class="loading-content"><div class="txt">正在加载</div><div class="load-progress"></div></div></div>',restrict:"EA",link:function(b,c){var d,e;b.$on("loading-add",function(){a.layer>0&&(clearTimeout(e),clearTimeout(d),d=setTimeout(function(){c.css("display","block"),c.addClass("show")},200))}),b.$on("loading-remove",function(){b.click=a._doClick,a.layer<=0?(a.layer=0,clearTimeout(d),e=setTimeout(function(){c.removeClass("show"),c.css("display","none")},100)):c.addClass("show")}),c.on("touchmove",function(a){a.preventDefault()})}}}]),bigUi.service("dialog",["$rootScope",function(a){var b=this;this.layer=0,b.show=function(b){a.$broadcast("dialog-show",b)},b.hide=function(b){a.$broadcast("dialog-hide",b)}}]),bigUi.directive("appDialog",["dialog","$timeout",function(a){return{replace:!0,scope:{option:"="},transclude:!0,template:'<div class="app-dialog" ng-show="option.show">    <div class="layer"></div>    <div class="dialog-container" ng-transclude>    </div></div>',restrict:"EA",link:function(b){b.option.headDisplay=1,b.$on("dialog-hide",function(){b.option.show=0,b.option.headDisplay=1}),b.closeDialog=function(){a.hide()}}}}]),bigUi.directive("dialogAlert",["dialog",function(a){return{replace:!0,scope:{option:"="},template:'<span><app-dialog option="option">    <div class="dialog-alert">        <p class="txt">            {{option.txt}}        </p>        <div class="dialog-btn-bar">            <div ng-if="option.b1!=\'\'" class="btn btn-submit" ng-click="confirm()">{{option.b1}}</div>            <div ng-if="option.b2!=\'\'" class="btn btn-grey" ng-click="cancel()">{{option.b2}}</div>        </div>    </div></app-dialog></span>',restrict:"EA",link:function(b,c,d){b.confirm=function(){a.hide(),"undefined"!=typeof b.option.confirm&&b.option.confirm.call(this)},b.cancel=function(){a.hide(),"undefined"!=typeof b.option.cancel&&b.option.cancel.call(this)}}}}]),bigUi.directive("popupSetting",["dialog","global","globalTips","designSetting",function(a,b,c,d){return{replace:!0,scope:{option:"="},templateUrl:"views/directives/popup_setting.html",restrict:"EA",link:function(e){e.option.formData={},e.themeIcon=d.nav_icon_info,e.viewSelectList=d.viewSelectList,e.title={1:"焦点图设置",2:"功能区设置",3:"热门区设置",4:"推荐区设置",10:"自定义按钮"},e.imageSize=b.imageSize,e.uploadKeyArr=b.uploadKeyArr,e.$watch("option.show",function(a){1==a?(e.formData={},e.ready=!0,$.extend(!0,e.formData,e.option.formData)):e.ready=!1}),e.staticBasePath=b.staticBasePath,e.posts_type=d.posts_type,e.posts_id_type=d.posts_id_type,e.posts_id_type_simple=d.posts_id_type_simple,e.item_active=0,e.headerIconInit=function(){""==e.formData.data.icon_type&&(e.option.formData.data.icon_type="nav_1_1")};var f=0;e.popSettingInit=function(){f=0},e.popupItemInit=function(a){f<a.id&&(f=a.id)},e.editItem=function(a){e.validate()&&(e.item_active=a)},e.addItem=function(){if(e.validate())if(e.option.formData.setting.length>=20)c.push({txt:"无法添加内容，内容已达最大数，20条",type:"warn"});else{var a={};$.extend(!0,a,d.dataModule.home_page[e.option.formData.type-1]),a.id=++f,e.option.formData.setting.unshift(a),e.item_active=0}else c.push({txt:"您当前操作的内容有错误，请检查后再增加新的内容。",type:"warn"})},e.delItem=function(a){c.push({txt:"您删除了一条内容。",type:"warn"}),e.item_active==a&&(e.item_active=0),e.option.formData.setting.splice(a,1)};var g=0;e.content_error=[],e.recommendInit=function(){g=0,e.menuItemState=!0,e.content_error=[],e.validate()},e.recommendItemInit=function(a){g<a.order&&(g=a.order),(3==a.type||4==a.type)&&(e.menuItemState=!1)},e.recommendTabChange=function(a){1==a||2==a?e.menuItemState=!0:e.menuItemState=!1},e.addRecommend=function(){e.validate()||c.push({txt:"您有id填写错误，频道和版块只支持一个id，其他内容最多填写50个id",type:"warn"}),e.content_error.push({id:0}),e.item_active=0;var a={};$.extend(!0,a,d.dataModule.home_page[e.option.formData.type-1]),a.order=g++,e.option.formData.setting.data_src_cfg.content_setting.unshift(a)},e.delRecommend=function(a){var b=e.option.formData.setting.data_src_cfg.content_setting[a];(3==b.type||4==b.type)&&(e.menuItemState=!0),e.option.formData.setting.data_src_cfg.content_setting.splice(a,1)},e.confirm=function(){e.validate()?(a.hide(),c.push({txt:e.title[e.option.formData.type]+"已经更新，如要保存请点击“保存设置”",type:"success"}),e.item_active=0,"undefined"!=typeof e.option.confirm&&(e.option.confirm.call(this),e.formError={title:0,pic:0,url:0,flag:0,name:0,desc:0},e.recomm_error=[{display_id:0,forbidden_id:0},{display_id:0,forbidden_id:0},{display_id:0,forbidden_id:0}])):c.push({txt:"您填写的内容有误，请根据提示检查后再做提交。",type:"warn"})},e.cancel=function(){a.hide(),e.item_active=0;var b={};$.extend(!0,b,e.formData),e.option.formData=b,"undefined"!=typeof e.option.cancel&&e.option.cancel.call(this),e.formError={title:0,pic:0,url:0,flag:0,name:0,desc:0},e.recomm_error=[{display_id:0,forbidden_id:0},{display_id:0,forbidden_id:0},{display_id:0,forbidden_id:0}]},e.formError={title:0,pic:0,url:0,flag:0,name:0,desc:0},e.error_msg={title:"请输入1~6个字",name:"请输入0~4个字",pic:"请上传图片",url:"请输入正确的URL地址，URL地址必须以http://或者https://开头",desc:"请填写描述",display_id:"仅可以填写数字，且id数不能大于50个",forbidden_id:"仅可以填写数字，且id数不能大于50个"},e.recomm_error=[{display_id:0,forbidden_id:0},{display_id:0,forbidden_id:0},{display_id:0,forbidden_id:0}],e.validate=function(){var a=!0,c=["title","pic","url","flag","desc"];if(4!=e.option.formData.type&&10!=e.option.formData.type&&e.option.formData.setting.length){var d=e.option.formData.setting[e.item_active];$.each(c,function(c,f){var g=d[f];switch(e.formError[f]=0,f){case"title":(""==g||b.getStrLen(g)>12)&&(a=!1,e.formError[f]=1);break;case"desc":b.getStrLen(g)>32&&(a=!1,e.formError[f]=1);break;default:(""==g||void 0==g)&&(a=!1,e.formError[f]=1)}})}if(4==e.option.formData.type&&2==e.option.formData.setting.data_src_cfg.type){var d=e.option.formData.setting.data_src_cfg.recomm_setting,c=["title"],f=["display_id","forbidden_id"];e.recomm_error=[{title:0,display_id:0,forbidden_id:0},{title:0,display_id:0,forbidden_id:0},{title:0,display_id:0,forbidden_id:0}],$.each(d,function(d,g){$.each(f,function(c,f){var h=[];void 0!=g[f]&&(h=b.getId(g[f])),void 0==g[f]||h.length>50?(a=!1,e.recomm_error[d][f]=1):g[f]=h.join(",")}),$.each(c,function(c,f){var h=g[f];switch(f){case"title":(b.getStrLen(h)>8||""==h)&&(a=!1,e.recomm_error[d][f]=1)}})})}if(4==e.option.formData.type&&1==e.option.formData.setting.data_src_cfg.type){var g=e.option.formData.setting.data_src_cfg.content_setting;e.content_error=[],$.each(g,function(c,d){var f=0,g=50,h=[];void 0!=d.id&&(h=b.getId(d.id)),void 0==d.id||h.length>g?(a=!1,f=1):d.id=h.join(","),e.content_error.push({id:f})})}if(10==e.option.formData.type){var c=["name"],d=e.option.formData.data;$.each(c,function(c,f){var g=d[f];switch(e.formError[f]=0,f){case"name":b.getStrLen(g)>8&&(a=!1,e.formError[f]=1)}})}return a}}}}]),bigUi.directive("tabToggle",[function(){return{replace:!0,transclude:!0,scope:{exClass:"@",name:"@",value:"=",disable:"=",callback:"&",index:"="},template:'<nav class="tab-toggle {{exClass}}"><div class="li toggle-btn" ng-class="{active : index == list.value , disable : dis[$index]}" ng-click="toggleBtn($index,list.value)" data-id="{{$index}}" data-value="list.value" ng-repeat="list in value">{{list.name}}</div><div class="clear"></div><div ng-transclude></div></nav>',restrict:"EA",link:function(a,b){function c(b){if(b)for(var c in b)a.dis[b[c]]=1}a.dis=[],c(a.disable),""==a.name&&(a.name="tempItem"),a.toggleBtn=function(c,d){a.dis[c]||(a.index=d,"undefined"!=typeof a.callback&&a.callback({index:c,element:b,value:d}))}}}}]),frame.service("appHeader",["$rootScope",function(a){var b=this;b.userInfo={},b.isLogin=function(){a.$broadcast("is-login")},b.isLogout=function(){a.$broadcast("is-logout")},b.setActive=function(){a.$broadcast("set-active")},b.setBaseInfo=function(b){a.$broadcast("set-baseInfo",b)}}]).directive("appHeader",["global","$location","$window","appHeader",function(a,b,c,d){return{replace:!0,scope:{value:"="},templateUrl:"views/frame/header.html",restrict:"EA",controller:["$scope","$element",function(a,b){}],link:function(b){b.appName=a.appName,b.img_logo=a.img_logo,b.link=a.link,b.baseInfo={url:{appPack:""}},b.logout=function(){b.login_url=d.login_url,c.location.href=a.link.logout_url},b.$on("is-login",function(){b.state="login",b.info=d.userInfo}),b.$on("is-logout",function(){b.state="logout"}),b.$on("set-active",function(){b.active=a.menuActive}),b.$on("set-baseInfo",function(a,c){b.baseInfo.url.appPack=c})}}}]),bigUi.filter("themeIconConvert",["global",function(a){return function(b,c,d){var e=b,f=1,g="";return e?(""!=d&&(e=e.split(d).pop()),"-1"!=e.indexOf("_")&&(g=parseInt(e.split("_")[1]),f=parseInt(e.split("_")[0])),{backgroundImage:"url("+a.staticBasePath+"images/theme/"+d+f+".png)",backgroundPosition:"0 -"+(g-1)*c+"px"}):b}}]),bigUi.service("themeIcon",["$rootScope",function(a){var b=this;b.userInfo={}}]).directive("themeIcon",["global",function(a){return{replace:!0,scope:{option:"=",value:"="},templateUrl:"views/directives/theme_icon.html",restrict:"EA",controller:["$scope","$element",function(a,b){}],link:function(b){function c(a){$(a.target).is($(".current-icon"))||$(a.target).is($(".current-icon .theme-icon"))||(b.listShow=!1,b.$apply())}b.iconList=[],b.listShow=!1,b.main=1,$.each(b.option.data,function(c,d){b.iconList[c]=[];for(var e=1;e<=d.total;e++)b.iconList[c].push({id:b.option.prefix+d.type+"_"+e,value:{"background-position":"0 -"+36*(e-1)+"px","background-image":"url("+a.staticBasePath+"images/theme/"+b.option.prefix+(c+1)+".png)"}})}),b.selectIcon=function(a){console.log(a),b.value=a,b.main=a.split("_")[0],b.callList()},b.callList=function(){b.listShow=b.listShow?!1:!0,$(document).unbind("click",c),$(document).bind("click",c)}}}}]),bigUi.service("themeIcon",["$rootScope",function(a){var b=this;b.userInfo={}}]).directive("uploadImg",["global","$timeout",function(a,b){return{replace:!0,scope:{option:"=",src:"=",fileId:"@",type:"@",error:"=",errorMsg:"="},templateUrl:"views/directives/upload_img.html",restrict:"EA",controller:["$scope","$element",function(c,d){var e={ele:null,files:[],key:a.uploadKeyArr[c.type-1],status:"0",typeArr:["jpg","png","gif"],error_msg:"请上传图片",url:""};console.log(e),$.extend(e,c.option),console.log(e),c.btnName="选择图片",b(function(){a.imgFileUpload(c.fileId,e,c,function(a){c.src=a.imgurl,c.error=0,c.errorMsg=e.error_msg,c.btnName="上传成功"},function(a){c.error=1,c.errorMsg=a.error_msg,c.$apply(),c.btnName="上传失败",console.log(a)})})}],link:function(a){}}}]),bigUi.service("globalTips",["$rootScope","$q",function(a,b){var c=this;c.list=[],c.count=0;var d=b.defer();c.push=function(b){var e={txt:"",type:"",id:c.count};return $.extend(e,b),a.$broadcast("pushTips",c.count),c.list.unshift(e),c.count++,a.$broadcast("tipsClick",d.resolve),d.promise}}]).directive("globalTips",["global","$timeout","globalTips",function(a,b,c){return{replace:!0,scope:{option:"=",src:"=",id:"@",type:"@"},template:'<div class="global-tips" ng-class="{\'global-tips-fixed\':fixed}">    <div ng-click="tipsClick()" id="tips_{{list.id}}" class="item {{list.type}}" ng-repeat="list in list | orderBy:\'id\':true"><div class="txt">{{list.txt}}</div></div></div>',restrict:"EA",controller:["$scope","$element",function(a,d){a.list=[],a.fixed=!1,$(window).scroll(function(){var b=$("#header").height();$("body").scrollTop()>b?a.fixed=!0:a.fixed=!1,a.$apply()}),a.$on("pushTips",function(e,f){a.list=c.list,b(function(){d.find("#tips_"+f).addClass("timeout"),$.each(a.list,function(b){f==a.list[b].id&&a.list.splice(b,1)})},3e3)}),a.$on("tipsClick",function(b,c){a.tipsClick=function(){c()}})}]}}]),frame.service("phonePreview",["$rootScope",function(a){var b=this;b.userInfo={},b.update=function(){a.$broadcast("preview-update")}}]).directive("phonePreview",["global","$location","$window","appHeader",function(a,b,c,d){return{replace:!0,scope:{preview:"="},templateUrl:"views/frame/phone-preview.html",restrict:"EA",link:function(b){b.staticBasePath=a.staticBasePath}}}]),app.controller("MainCtrl",["$rootScope","$scope","global","localStorage","$timeout","$q","globalTips","designSetting",function(a,b,c,d,e,f,g,h){function i(a){return b.preview.data={},10>a&&a>=2?(b.preview.data.id=a,!0):void h.getViewData(a).then(function(a){$.extend(!0,b.preview.data,h.dataModule.baseTree,a)},function(a){})}function j(a){c.getData({api:c.api.page,data:{selected:a},onSuccess:function(a){if(0==a.code){var c={};$.extend(!0,c,h.dataModule.button_cfg),b.form=c,$.extend(!0,b.form,a.data),b.viewSelectChange()}else alert("出错！")}})}b.init=!1,h.init(function(){b.init=!0,b.staticBasePath=c.staticBasePath,b.form={},b.formError={name:0,icon_type:0,view_type:0},b.error_msg={name:"请输入0~4个字",icon_type:"请设置图标",view_type:"请设置视图"},b.setModule=h.module,b.module="setMain",b.viewSelectList={},b.inner_views=h.views.inner_views,b.outer_views=h.views.outer_views,b.viewSelectList=h.viewSelectList,b.$on("set-main",function(){b.viewSelectChange(),b.inner_views=h.views.inner_views,b.outer_views=h.views.outer_views,b.viewSelectList=h.viewSelectList,b.module="setMain",b.isMain=!0}),j(1),b.skeleton=[],c.getData({api:c.api.skeleton,onSuccess:function(a){b.skeleton=a.data}})}),b.isMain=!0;b.fixed=!1,$("body").width()>1240&&(b.fixed=!0),window.onresize=function(){$("body").width()>1240?b.fixed=!0:b.fixed=!1,b.$apply()},b.guide={step:1,prefix:"guide-step-",nowStep:1,show:h.guided,next:function(){b.guide.nowStep++,b.guide.nowStep>b.guide.step&&(b.guide.show=!1,h.guided=!1,b.guide.nowStep=1)}},b.guide.show&&window.scrollTo(0,$("body").height()),b.themeIcon=h.theme_icon_info,b.btn_list=h.btn_list,b.tab_list=h.tab_list,b.saveAlert={show:0,txt:"",b1:"确定",b2:"取消",skeleton_page:b.skeleton_page,confirm:null},b.skeleton_page=1,b.changeTab=function(a){return b.guide.show?!1:void(a+1!=b.skeleton_page&&(b.saveAlert.txt="您是否要保存当前模块的设置？",$.extend(b.saveAlert,{show:1,skeleton_page:a+1,confirm:function(){b.saveSetting(b.form,b.skeleton_page).then(function(){b.skeleton_page=b.saveAlert.skeleton_page,j(b.skeleton_page)})},cancel:function(){b.skeleton_page=b.saveAlert.skeleton_page,j(b.skeleton_page)}})))},b.preview={data:{}},b.viewSelectChange=function(){i(b.form.view_type)},b.editView=function(a){switch(parseInt(a)){case 2:b.module="viewForum";break;default:b.module="viewModule"}b.activeViewType=a,b.isMain=!1},b.addView=function(){b.module="viewModule",b.activeViewType=h.maxViewTypeId+1,b.isMain=!1},b.delView=function(a){b.saveAlert.txt="您是否要删除当前视图？",$.extend(b.saveAlert,{show:1,confirm:function(){return a==b.form.view_type?(g.push({txt:"删除失败，视图正在使用中",type:"warn"}),!1):void c.getData({api:c.api.deleteView,data:{vid:a},onSuccess:function(c){0==c.code?(delete b.outer_views[a],delete h.views_data[a],delete h.viewSelectList[a],delete b.viewSelectList[a]):2==c.code?g.push({txt:"删除失败，视图正在使用中",type:"warn"}):3==c.code?g.push({txt:"删除失败，视图正应用在您的APP中",type:"warn"}):1==c.code&&g.push({txt:c.msg,type:"warn"})}})},cancel:function(){}})};b.saveSetting=function(a,e){var h=f.defer();if(b.validate()){d.clear();var i=c.base64.encode(c.base64.utf16to8(JSON.stringify(b.form)));c.getData({api:c.api.save,data:{settings:i,selected:e},onSuccess:function(c){d.clear(),b.skeleton[b.skeleton_page-1].icon_type=a.icon_type,h.resolve(c),
g.push({txt:"保存成功",type:"success"})}})}else g.push({txt:"保存失败，请检查填写内容",type:"error"}),h.reject();return h.promise},b.validate=function(){var a=!0,d=["name","icon_type","view_type"];return $.each(d,function(d,e){var f=b.form[e];switch(b.formError[e]=0,e){case"name":c.getStrLen(f)>8&&(a=!1,b.formError[e]=1);break;case"icon_type":f||(a=!1,b.formError[e]=1);break;case"view_type":f||(a=!1,b.formError[e]=1)}}),a},b.applySetting=function(a,e){$.extend(b.saveAlert,{txt:"正要将您所有已保存的配置信息应用到您的手机APP上，这些配置将会在手机APP重启之后立即生效，请确认您的操作？",show:1,skeleton_page:e+1,confirm:function(){d.clear();var f=c.base64.encode(c.base64.utf16to8(JSON.stringify(b.form)));c.getData({api:c.api.save,data:{settings:f,selected:e},onSuccess:function(h){d.clear(),b.skeleton[b.skeleton_page-1].icon_type=a.icon_type,g.push({txt:"保存成功",type:"success"}),c.getData({api:c.api.apply,data:{settings:f,selected:e},onSuccess:function(a){g.push({txt:"应用成功",type:"success"})}})}})}})},b.resetSetting=function(){$.extend(b.saveAlert,{txt:"您是否要恢复到上次应用的设置？",show:1,confirm:function(){c.getData({api:c.api.roback,data:{selected:b.skeleton_page},onSuccess:function(a){0==a.code?(b.form=h.dataModule.button_cfg,$.extend(!0,b.form,a.data),b.activeViewType=a.data.view_type,b.viewSelectChange()):0!=a.code?g.push({txt:"“还没有设置可还原",type:"warn"}):alert("出错！")}})},cancel:function(){}})}}]),app.controller("SetModuleCtrl",["$rootScope","$scope","global","localStorage","$timeout","$q","globalTips","designSetting",function(a,b,c,d,e,f,g,h){function i(a){c.getData({api:c.api.page,data:{selected:a},onSuccess:function(a){if(0==a.code){var e={};if($.extend(!0,e,c.base_data),b.form=e,$.extend(!0,b.form,a.data),!l){l=!0;var f=d.getItem("setting");null==f||b.skeleton_page==f.skeleton_page&&JSON.stringify(b.form)==JSON.stringify(f.data)||g.push({txt:"您上次的操作没有保存，点击这条提示恢复并继续编辑",type:"warn"}).then(function(){b.skeleton_page=f.skeleton_page,b.form=f.data})}j(3e3)}else alert("出错！")}})}function j(c){return a["default"].autoSaveLocal?(k.data=b.form,k.skeleton_page=b.skeleton_page,d.setItem("setting",k),void setTimeout(function(){j(c)},c)):(d.clear(),!1)}b.viewSelectList={},b.inner_views=h.views.inner_views,b.outer_views=h.views.outer_views,angular.extend(b.viewSelectList,h.views.inner_views,h.views.outer_views),b.editView=function(a){console.log(b.module),b.module="viewModule",b.activeViewType=a};var k={skeleton_page:1,data:{}};i(1);var l=!1;b.saveSetting=function(a,b){alert(b)},b.resetSetting=function(){$.extend(b.saveAlert,{txt:"您是否要恢复到上次应用的设置？",show:1,confirm:function(){c.getData({api:c.api.roback,data:{selected:b.skeleton_page},onSuccess:function(a){console.debug(a),0==a.code?(b.form=c.base_data,$.extend(!0,b.form,a.data)):0==a.code?g.push({txt:"“还没有设置可还原",type:"warn"}):alert("出错！")}})},cancel:function(){}})}}]),app.controller("ViewModuleCtrl",["$rootScope","$scope","global","localStorage","$timeout","$q","globalTips","designSetting",function(a,b,c,d,e,f,g,h){function i(){var a=!0;if(console.log("checkConf",b.form.tab_type),2==b.form.tab_type&&((a=b.navValidate())||g.push({txt:"您的导航设置内容有错误，请检查后再增加新的内容。",type:"warn"})),3==b.form.tab_type){var c=["wap_page"];$.each(c,function(c,d){var e=b.form[d];(""==e||void 0==e)&&(a=!1,b.formError[d]=1)})}return a}function j(){h.getViewData(b.activeViewType).then(function(a){$.extend(!0,b.form,h.dataModule.baseTree,a),b.preview.data=b.form,console.log(b.preview),b.ready=!0},function(a){})}function k(a,c){var d=!0;return $.each(c,function(c,e){var f=a[e];console.log(f),(""==f||void 0==f)&&(d=!1,b.navFormError[e]=1)}),d}b.tab_list=h.tab_list,b.nav_tab_list=[{id:"1",value:"单页面"},{id:"3",value:"WAP页面"}],b.ready=!1,b.form={},b.viewInit=function(){console.log("ViewModuleCtrl"),b.form={},b.activeViewType>h.maxViewTypeId?(console.log(h.dataModule.baseTree),$.extend(!0,b.form,h.dataModule.baseTree),b.form.id=b.activeViewType,b.preview.data=b.form,console.debug(b.preview),b.ready=!0):j()},b.popup={show:0,type:1},b.callSetting=function(a){console.log(a),b.popup.show=1,b.popup.formData=a,b.popup.confirm=function(){},b.popup.cancel=function(){$.each(a,function(c){a[c]=b.popup.formData[c]})}},b.delHeaderIcon=function(a){console.log("delHeaderIcon"),$.extend(b.form.title_cfg[a],h.dataModule.title_cfg)},b.callHeaderSetting=function(a){b.popup.show=1,b.popup.formData={type:10,data:a},b.popup.confirm=function(){},b.popup.cancel=function(){$.each(a,function(c){a[c]=b.popup.formData.data[c]})}},b.save=function(a){b.saveSetting(a).then(function(a){b.preview.data={},h.setMain(a.views),b.ready=!1},function(){g.push({txt:"保存失败，请检查您的网络。",type:"warn"})})},b.cancel=function(){h.setMain(),b.preview.data={},b.ready=!1},b.getSettingEnable=function(a){var b=0;return $.each(a,function(a,c){1==c.flag&&b++}),b};var l=0;b.menuInit=function(){for(var a=b.form.navi_page.navi,c=a.length,d=0;c>d;d++)b.navFormError[d]={navi_name:0,wap_page:0}},b.menuItemInit=function(a,b){(void 0==a||""==a)&&(a=b),a>l&&(l=a)},b.addMenu=function(){if(b.form.navi_page.navi.length>=30)return g.push({txt:"无法继续添加，导航已达最大数目，30条",type:"warn"}),!1;if(0==b.form.navi_page.navi.length||b.navValidate()){var a={};$.extend(!0,a,h.dataModule.navi_page),a.id=++l,b.form.navi_page.navi.unshift(a),b.form.navi_page.selected=1,b.navFormError.unshift({navi_name:0,wap_page:0})}else g.push({txt:"您当前操作的内容有错误，请检查后再增加新的内容。",type:"warn"})},b.editMenu=function(a){b.navValidate()?a==b.form.navi_page.selected-1?b.form.navi_page.selected=0:b.form.navi_page.selected=a+1:g.push({txt:"您当前操作的内容有错误，请检查后再增加新的内容。",type:"warn"})},b.delMenu=function(a){b.form.navi_page.selected=0,b.form.navi_page.navi.splice(a,1),b.navFormError[0]={navi_name:0,wap_page:0}},b.saveSetting=function(a){var e=f.defer();if(b.validate()){d.clear(),console.log(a);var i=c.base64.encode(c.base64.utf16to8(JSON.stringify(a)));c.getData({api:c.api.saveView,data:{settings:i,vid:b.activeViewType},onSuccess:function(c){"0"==c.code&&(d.clear(),e.resolve(c),h.views_data[b.activeViewType]=a,g.push({txt:"保存成功",type:"success"}))},onError:function(a){e.reject(a)}})}return e.promise},b.defaultSetting=function(){var a=b.form.button_type,c=b.form.tab_type;b.form=h.dataModule.baseTree,b.form.id=b.skeleton_page,b.form.button_type=a,b.form.tab_type=c,g.push({txt:"您对当前版块的内容进行了重置",type:""})},b.formError={name:0,title:0,wap_page:0},b.error_msg={name:"请输入1~8个字",title:"请输入0~6个字",wap_page:"请输入正确的URL地址，URL地址必须以http://或者https://开头"},b.validate=function(){var a=!0;b.formError={name:0,title:0,wap_page:0};var d=["name","title"];return $.each(d,function(d,e){var f=b.form[e];switch(e){case"name":(c.getStrLen(f)>16||""==f)&&(a=!1,b.formError[e]=1);break;case"title":c.getStrLen(f)>12&&(1!=b.form.use_wap_name||3!=b.form.tab_type)&&(a=!1,b.formError[e]=1);break;default:(""==f||void 0==f)&&(a=!1,b.formError[e]=1)}}),a&&i()},b.navFormError=[],b.navError_msg={navi_name:"请输入1~12个字",wap_page:"请输入正确的URL地址，URL地址必须以http://或者https://开头"},b.checkMenuItem=function(a){var c=!1;return $.each(b.navFormError[a],function(a,b){0!=b&&(c=!0)}),c},b.navValidate=function(){function a(a,d){var e=!0,f=["navi_name"];return(""==a.order||void 0==a.order)&&(a.order="0"),3==a.navi_setting.tab_type&&(e=e&&k(a.navi_setting,["wap_page"])),$.each(f,function(f,g){b.navFormError[d][g]=0;var h=a[g];switch(console.log(h),g){case"navi_name":console.log(c.getStrLen(h)),(c.getStrLen(h)>12||""==h)&&(e=!1,b.navFormError[d][g]=1);break;default:(""==h||void 0==h)&&(e=!1,b.navFormError[d][g]=1)}}),console.log(e),e}var d=!0,e=b.form.navi_page.selected-1,f=b.form.navi_page.navi;if(e+1!=0){b.navFormError[e]={navi_name:0,wap_page:0};var g=f[e];d=d&&(void 0==g||a(g,e))}else $.each(f,function(c,e){b.navFormError[c]={navi_name:0,wap_page:0},d=d&&a(e,c)});return d}}]),app.controller("ViewForumCtrl",["$rootScope","$scope","global","localStorage","$timeout","$q","globalTips","designSetting",function(a,b,c,d,e,f,g,h){b.form=h.views.inner_views[2],b.save=function(a){b.saveSetting(a).then(function(a){b.preview.data={},h.setMain(a.views),b.ready=!1},function(){g.push({txt:"保存失败，请检查您的网络。",type:"warn"})})},b.cancel=function(){h.setMain(),b.preview.data={},b.ready=!1},b.getSettingEnable=function(a){var b=0;return $.each(a,function(a,c){1==c.flag&&b++}),b},b.saveSetting=function(a){var e=f.defer();if(b.validate()){d.clear(),console.log(a);var i=c.base64.encode(c.base64.utf16to8(JSON.stringify(a)));c.getData({api:c.api.saveView,data:{settings:i,vid:b.activeViewType},onSuccess:function(c){"0"==c.code&&(d.clear(),e.resolve(c),h.views_data[b.activeViewType]=a,g.push({txt:"保存成功",type:"success"}))},onError:function(a){e.reject(a)}})}return e.promise},b.formError={displayid:0,forbiddenid:0},b.error_msg={displayid:"仅可以填写数字，且id数不能大于50个",forbiddenid:"仅可以填写数字，且id数不能大于50个"},b.validate=function(){var a=!0;b.formError={displayid:0,forbiddenid:0};var d=["displayid","forbiddenid"];return $.each(d,function(d,e){var f=[];void 0!=b.form[e]&&(f=c.getId(b.form[e])),void 0==b.form[e]||f.length>50?(a=!1,b.formError[e]=1):b.form[e]=f.join(",")}),a}}]),app.controller("StyleSetCtrl",["$rootScope","$scope","global","localStorage","$timeout","$q","globalTips","designSetting",function(a,b,c,d,e,f,g,h){b.staticBasePath=c.staticBasePath,b.fixed=!1,$("body").width()>1240&&(b.fixed=!0),window.onresize=function(){$("body").width()>1240?b.fixed=!0:b.fixed=!1,b.$apply()},b.saveAlert={show:0,txt:"",b1:"确定",b2:"取消",skeleton_page:b.skeleton_page,confirm:null},b.form={},c.getData({api:c.api.getStyleStting,onSuccess:function(a){0==a.code?b.form=a.data:g.push({txt:"数据加载失败，请刷新后重试",type:"error"})},onError:function(a){g.push({txt:"数据加载失败，请刷新后重试",type:"error"})}}),b.applySetting=function(){$.extend(b.saveAlert,{txt:"正要将您所有已保存的配置信息应用到您的手机APP上，这些配置将会在手机APP重启之后立即生效，请确认您的操作？",show:1,confirm:function(){c.getData({api:c.api.saveStyleStting,data:{settings:b.form},onSuccess:function(a){0==a.code?g.push({txt:"应用成功",type:"success"}):g.push({txt:"保存失败，请尝试再次提交或刷新操作",type:"error"})},onError:function(a){g.push({txt:"保存失败，请尝试再次提交或刷新操作",type:"error"})}})}})}}]),angular.module("designApp").run(["$templateCache",function(a){a.put("views/base-setting.html",'<div id="designSetting" class="set-container"> <header class="set-title"><h2>布局设置</h2></header> <section class="set-content full"> <form class="app-form set-form" name="setForm"> <div class="form-content"> <!--<h2>1、布局设置</h2>--> <!--<div class="field">--> <!--<div class="name">是否开启该版块</div>--> <!--<div class="value">--> <!--<div class="radio-list">--> <!--<label class="checkbox"><input name="switch" ng-model="option.formData.enable" value="1" type="radio"/> <span>底部Tab导航布局</span></label>--> <!--<label class="checkbox"><input name="switch" ng-model="option.formData.enable" value="0" type="radio"/> <span>左侧树状菜单导航布局</span></label>--> <!--</div>--> <!--</div>--> <!--</div>--> <h2>1、按钮设置</h2> <div class="field" ng-class="{ \'error\' : formError.name!=0}"> <div class="name">按钮名称</div> <div class="value"> <div class="input-text"><input type="text" ng-model="form.name" name="btnName"></div> <div class="form-tips">0~4个字，当您不设置按钮名称时，按钮图标将会自动占满整个空间</div> <div class="form-error">{{error_msg.name}}</div> </div> </div> <div class="field" ng-class="{ \'error\' : formError.name!=0}"> <div class="name">按钮图标</div> <div class="value"> <theme-icon option="themeIcon" value="form.icon_type"></theme-icon> </div> <div class="form-error">{{error_msg.icon_type}}</div> </div> <div class="field" ng-class="{ \'error\' : formError.name!=0}"> <div class="name">视图类型</div> <div class="value"> <select ng-change="viewSelectChange()" ng-required="1" name="view_type" ng-model="form.view_type" id="view_type" ng-options="option.id as option.name for option in viewSelectList | viewType"></select> </div> <div class="form-error">{{error_msg.view_type}}</div> </div> <div class="field m30-0"> <div class="name">&nbsp;</div> <div class="value"> <div class="btn btn-submit" ng-click="saveSetting(form,skeleton_page)">保存设置</div> </div> </div> <div class="hr hr-dashed"></div> </div> <div class="form-content pb30"> <h2>2、自定义视图管理</h2> <div class="view-list view-list-base"> <div class="name">内置视图</div> <ul> <li ng-repeat="list in inner_views"> <div class="view-icon"> <div class="item-ctrl" ng-if="list.id == 2"><span class="ctrl-icon ctrl-icon-edit" ng-click="editView(list.id)"></span></div> </div><br> <div class="view-name">{{list.name}}</div> </li> </ul> </div> <div class="view-list view-list-custom"> <div class="name">自定义视图</div> <ul> <li ng-repeat="list in outer_views"> <div class="view-icon"><div class="item-ctrl"><span class="ctrl-icon ctrl-icon-edit" ng-click="editView(list.id)"></span><span class="ctrl-icon ctrl-icon-del" ng-click="delView(list.id)"></span></div></div><br> <div class="view-name">{{list.name}}</div> </li> <li class="add-view" ng-click="addView()"> <div class="view-icon"></div><br> <div class="view-name">新增</div> </li> </ul> </div> </div> </form> </section> </div>'),a.put("views/directives/popup_setting.html",'<div> <app-dialog option="option"> <div id="popupSetting" class="set-container" ng-if="ready"> <header class="set-title"><h2>{{title[option.formData.type]}}</h2></header> <section class="set-content"> <form class="app-form" ng-init="popSettingInit()" id="focusSetting" ng-if="option.formData.type == 1"> <div class="setting-list"> <header class="list-head"> <h3>排序</h3> <div class="order-btn">排序</div> </header> <div class="demo-img"><img ng-src="{{staticBasePath}}images/preview/focus.jpg" alt=""></div> <div class="list-content"> <div class="item" ng-init="popupItemInit(list)" ng-class="{active: item_active == $index}" ng-repeat="list in option.formData.setting track by $index"> <div class="item-option" ng-click="editItem($index)"> <div class="focus-img demo-icon"> <div class="demo-icon-tips">封面图片</div> <img ng-if="!!list.pic" ng-src="{{list.pic}}" alt=""> </div> <h4>{{list.title}}</h4> <input type="text" class="order-num" ng-pattern="/^\\d{1,3}$/" name="order" ng-model="list.order"> </div> <div class="del-item" ng-click="delItem($index)">删除</div> <div class="item-arrow"></div> <div class="setting-form"> <div class="form-content"> <div class="field"> <div class="name">显示该版块</div> <div class="value"> <label class="checkbox"><input type="checkbox" ng-model="list.flag" ng-true-value="\'1\'" ng-false-value="\'0\'"> <span>显示</span></label> </div> </div> <div class="field" ng-class="{ \'error\' : formError.title!=0}"> <div class="name">名称(必填)</div> <div class="value"> <div class="input-text"><input type="text" ng-model="list.title" name="title"></div> <div class="form-error">{{error_msg.title}}</div> </div> </div> <div class="field" ng-class="{ \'error\' : formError.pic!=0}"> <div class="name">图片(必填)</div> <div class="value"> <div class="upload-img"> <upload-img option="appPicFile" file-id="pic1_{{list.id}}" src="list.pic" type="{{option.formData.type}}" error="formError.pic" error-msg="error_msg.pic"></upload-img> <div class="form-tips">图片大小最小为{{imageSize[uploadKeyArr[formData.type-1]].width}}X{{imageSize[uploadKeyArr[formData.type-1]].height}}</div> <div class="form-error">{{error_msg.pic}}</div> </div> </div> </div> <div class="field" ng-class="{ \'error\' : formError.url!=0}"> <div class="name">链接URL(必填)</div> <div class="value"> <div class="input-text"><input type="url" ng-model="list.url" name="url"></div> <div class="form-error">{{error_msg.url}}</div> </div> </div> <div class="field"> <div class="name">类别(必填)</div> <div class="value"> <select class="select-nor" ng-required="1" name="posts_type" ng-model="list.type" ng-options="option.id as option.value for option in posts_type"></select> </div> </div> </div> </div> </div> <div class="add-item" ng-click="addItem()"></div> </div> </div> <div class="form-content setting-other"> <div class="field"> <div class="name">是否开启该版块</div> <div class="value"> <div class="radio-list"> <label class="checkbox"><input name="switch" ng-model="option.formData.enable" value="1" type="radio"> <span>开启</span></label> <label class="checkbox"><input name="switch" ng-model="option.formData.enable" value="0" type="radio"> <span>不开启</span></label> </div> </div> </div> </div> </form> <form class="app-form" ng-init="popSettingInit()" id="ctrlSetting" ng-if="option.formData.type == 2"> <div class="setting-list"> <header class="list-head"> <h3>排序</h3> <div class="order-btn">排序</div> </header> <div class="demo-img"><img ng-src="{{staticBasePath}}images/preview/ctrl.jpg" alt=""></div> <div class="list-content"> <div class="item" ng-init="popupItemInit(list)" ng-class="{active: item_active == $index}" ng-repeat="list in option.formData.setting track by $index"> <div class="item-option" ng-click="editItem($index)"> <div class="demo-icon"><img ng-if="!!list.pic" ng-src="{{list.pic}}" alt=""></div> <h4>{{list.title}}</h4> <input type="text" class="order-num" ng-pattern="/^\\d{1,3}$/" name="order" ng-model="list.order"> </div> <div class="del-item" ng-click="delItem($index)">删除</div> <div class="item-arrow"></div> <div class="setting-form"> <div class="form-content"> <div class="field"> <div class="name">显示该版块</div> <div class="value"> <label class="checkbox"><input type="checkbox" ng-model="list.flag" ng-true-value="\'1\'" ng-false-value="\'0\'"> <span>显示</span></label> </div> </div> <div class="field" ng-class="{ \'error\' : formError.title!=0}"> <div class="name">名称(必填)</div> <div class="value"> <div class="input-text"><input type="text" ng-model="list.title" name="title"></div> <div class="form-error">{{error_msg.title}}</div> </div> </div> <div class="field" ng-class="{ \'error\' : formError.pic!=0}"> <div class="name">图片(必填)</div> <div class="value"> <div class="upload-img"> <upload-img option="appPicFile" file-id="pic2_{{list.id}}" src="list.pic" type="{{option.formData.type}}" error="formError.pic" error-msg="error_msg.pic"></upload-img> <div class="form-tips">图片大小最小为{{imageSize[uploadKeyArr[formData.type-1]].width}}X{{imageSize[uploadKeyArr[formData.type-1]].height}}</div> <div class="form-error">{{error_msg.pic}}</div> </div> </div> </div> <div class="field" ng-class="{ \'error\' : formError.url!=0}"> <div class="name">链接URL(必填)</div> <div class="value"> <div class="input-text"><input type="url" ng-model="list.url" name="url"></div> <div class="form-error">{{error_msg.url}}</div> </div> </div> <div class="field"> <div class="name">类别(必填)</div> <div class="value"> <select class="select-nor" ng-required="1" name="posts_type" ng-model="list.type" ng-options="option.id as option.value for option in posts_type"></select> </div> </div> </div> </div> </div> <div class="add-item" ng-click="addItem()"></div> </div> </div> <div class="form-content setting-other"> <div class="field"> <div class="name">是否开启该版块</div> <div class="value"> <div class="radio-list"> <label class="checkbox"><input name="switch" ng-model="option.formData.enable" value="1" type="radio"> <span>开启</span></label> <label class="checkbox"><input name="switch" ng-model="option.formData.enable" value="0" type="radio"> <span>不开启</span></label> </div> </div> </div> </div> </form> <form class="app-form" ng-init="popSettingInit()" id="hotSetting" ng-if="option.formData.type == 3"> <div class="setting-list"> <header class="list-head"> <h3>排序</h3> <div class="order-btn">排序</div> </header> <div class="demo-img"><img ng-src="{{staticBasePath}}images/preview/hot.jpg" alt=""></div> <div class="list-content"> <div class="item" ng-init="popupItemInit(list)" ng-class="{active: item_active == $index}" ng-repeat="list in option.formData.setting track by $index"> <div class="item-option" ng-click="editItem($index)"> <div class="demo-icon"><img ng-if="!!list.pic" ng-src="{{list.pic}}" alt=""></div> <div class="item-info"> <h4>{{list.title}}</h4> <div class="item-description">{{list.desc}}</div> </div> <input type="text" class="order-num" name="order" ng-model="list.order"> </div> <div class="del-item" ng-click="delItem($index)">删除</div> <div class="item-arrow"></div> <div class="setting-form"> <div class="form-content"> <div class="field"> <div class="name">显示该版块</div> <div class="value"> <label class="checkbox"><input type="checkbox" ng-model="list.flag" ng-true-value="\'1\'" ng-false-value="\'0\'"> <span>显示</span></label> </div> </div> <div class="field" ng-class="{ \'error\' : formError.title!=0}"> <div class="name">名称(必填)</div> <div class="value"> <div class="input-text"><input type="text" ng-model="list.title" name="title"></div> <div class="form-error">{{error_msg.title}}</div> </div> </div> <div class="field" ng-class="{ \'error\' : formError.pic!=0}"> <div class="name">图片(必填)</div> <div class="value"> <div class="upload-img"> <upload-img option="appPicFile" file-id="pic3_{{list.id}}" src="list.pic" type="{{option.formData.type}}" error="formError.pic" error_msg="error_msg.pic"></upload-img> <div class="form-tips">图片大小最小为{{imageSize[uploadKeyArr[formData.type-1]].width}}X{{imageSize[uploadKeyArr[formData.type-1]].height}}</div> <div class="form-error">{{error_msg.pic}}</div> </div> </div> </div> <div class="field" ng-class="{ \'error\' : formError.url!=0}"> <div class="name">链接URL(必填)</div> <div class="value"> <div class="input-text"><input type="url" ng-model="list.url" name="url"></div> <div class="form-error">{{error_msg.url}}</div> </div> </div> <div class="field"> <div class="name">类别(必填)</div> <div class="value"> <select class="select-nor" ng-required="1" name="posts_type" ng-model="list.type" ng-options="option.id as option.value for option in posts_type"></select> </div> </div> <div class="field" ng-class="{ \'error\' : formError.desc!=0}"> <div class="name">描述信息(必填)</div> <div class="value"> <div class="input-text"><input type="text" ng-model="list.desc" name="desc"></div> <div class="form-error">{{error_msg.desc}}</div> </div> </div> </div> </div> </div> <div class="add-item" ng-click="addItem()"></div> </div> </div> <div class="form-content setting-other"> <div class="field"> <div class="name">是否开启该版块</div> <div class="value"> <div class="radio-list"> <label class="checkbox"><input name="switch" ng-model="option.formData.enable" value="1" type="radio"> <span>开启</span></label> <label class="checkbox"><input name="switch" ng-model="option.formData.enable" value="0" type="radio"> <span>不开启</span></label> </div> </div> </div> </div> </form> <form class="app-form" ng-init="popSettingInit()" id="recommendSetting" ng-if="option.formData.type == 4"> <div class="setting-list recommend-type form-content"> <div class="field"> <div class="name">样式设置</div> <div class="value"> <div class="radio-list"> <label class="checkbox"><input name="pic_type" ng-model="option.formData.setting.type" type="radio" value="1"> <span>多图模式</span></label> <label class="checkbox"><input name="pic_type" ng-model="option.formData.setting.type" type="radio" value="2"> <span>无图模式</span></label> </div> </div> <div ng-show="option.formData.setting.type == 1" class="demo-img"><img ng-src="{{staticBasePath}}images/preview/recommend-s1-1.jpg" alt=""></div> <div ng-show="option.formData.setting.type == 2" class="demo-img"><img ng-src="{{staticBasePath}}images/preview/recommend-s1-2.jpg" alt=""></div> </div> <div class="field"> <div class="name">数据源设置</div> <div class="value"> <div class="radio-list"> <label class="checkbox"><input name="data_type" ng-model="option.formData.setting.data_src_cfg.type" type="radio" value="1"> <span>内容类</span></label> <label class="checkbox"><input name="data_type" ng-model="option.formData.setting.data_src_cfg.type" type="radio" value="2"> <span>推荐帖子类</span></label> </div> </div> <div ng-show="option.formData.setting.data_src_cfg.type == 1" class="demo-img"><img ng-src="{{staticBasePath}}images/preview/recommend-s2-1.jpg" alt=""></div> <div ng-show="option.formData.setting.data_src_cfg.type == 2" class="demo-img"><img ng-src="{{staticBasePath}}images/preview/recommend-s2-2.jpg" alt=""></div> </div> </div> <div class="form-content setting-other"> <div class="edit-model" ng-if="option.formData.setting.data_src_cfg.type == 2"> <div class="form-content setting-other"> <div class="field list-head"> <div class="name">是否开启该版块</div> <div class="value"> <div class="radio-list"> <label class="checkbox"><input name="switch" ng-model="option.formData.enable" value="1" type="radio"> <span>开启</span></label> <label class="checkbox"><input name="switch" ng-model="option.formData.enable" value="0" type="radio"> <span>不开启</span></label> </div> </div> </div> </div> <div class="model-content"> <div class="item" ng-repeat="list in option.formData.setting.data_src_cfg.recomm_setting track by $index"> <div class="item-head"> <h3>模块顺序</h3> <div class="order-num"><input type="text" ng-pattern="/^\\d{1,3}$/" name="order" ng-model="list.order"></div> </div> <div class="setting-form"> <div class="form-content"> <div class="field" ng-class="{ \'error\' : formError.flag!=0}"> <div class="name">启用该版块</div> <div class="value"> <label class="checkbox"><input type="checkbox" ng-model="list.flag" ng-true-value="\'1\'" ng-false-value="\'0\'"> <span>显示</span></label> <div class="form-error">{{error_msg.flag}}</div> </div> </div> <div class="field"> <div class="name">模块</div> <div class="value"><div class="form-tips">{{list.module}}</div></div> </div> <div class="field" ng-class="{ \'error\' : formError.title!=0}"> <div class="name">显示名称</div> <div class="value"> <div class="input-text"><input type="text" name="title" ng-model="list.title"></div> <div class="form-error">{{error_msg.title}}</div> </div> </div> <div class="field" ng-class="{ \'error\' : recomm_error[$index].display_id!=0}"> <div class="name">显示版块ID</div> <div class="value"> <div class="input-text"><input type="text" ng-pattern="/^[0-9,]+$/" name="display_id" ng-model="list.display_id"></div> <div class="form-error">{{error_msg.display_id}}</div> </div> </div> <div class="field" ng-class="{ \'error\' : recomm_error[$index].forbidden_id!=0}"> <div class="name">屏蔽版块ID</div> <div class="value"> <div class="input-text"><input type="text" ng-pattern="/^[0-9,]+$/" name="forbidden_id" ng-model="list.forbidden_id"></div> <div class="form-error">{{error_msg.forbidden_id}}</div> </div> </div> </div> </div> </div> </div> </div> <div class="edit-list" ng-init="recommendInit(list)" ng-if="option.formData.setting.data_src_cfg.type == 1"> <div class="form-content setting-other"> <div class="field list-head"> <div class="name">是否开启该版块</div> <div class="value"> <div class="btn btn-add-item" ng-click="addRecommend()">新增条目</div> <div class="radio-list"> <label class="checkbox"><input name="switch" ng-model="option.formData.enable" value="1" type="radio"> <span>开启</span></label> <label class="checkbox"><input name="switch" ng-model="option.formData.enable" value="0" type="radio"> <span>不开启</span></label> </div> </div> </div> </div> <!--<header class="list-head">--> <!--<div class="order-btn">排序</div>--> <!--<div class="btn btn-add-item" ng-click="addRecommend()">新增ID</div>--> <!--</header>--> <div class="list-content"> <div class="item item-fields"> <div class="field-order">&nbsp;</div> <div class="field-id">ID</div> <div class="field-type">内容类别</div> <div class="field-option">操作</div> </div> <div class="item" ng-init="recommendItemInit(list)" ng-repeat="list in option.formData.setting.data_src_cfg.content_setting track by $index"> <div class="field-order"><input type="text" class="order-num" name="order" ng-model="list.order"></div> <div class="field-id"><div class="input-text" ng-class="{\'error\': list.id == undefined || content_error[$index].id != 0}"><input ng-blur="validate();" type="text" ng-pattern="/^[0-9,]+$/" ng-model="list.id" name="id"></div></div> <div class="field-type"> <select ng-if="menuItemState || list.type == 3 || list.type == 4" ng-change="recommendTabChange(list.type)" class="select-nor" ng-required="1" name="posts_id_type" ng-model="list.type" ng-options="option.id as option.value for option in posts_id_type"></select> <select ng-if="!(menuItemState || list.type == 3 || list.type == 4)" class="select-nor" ng-required="1" name="posts_id_type" ng-model="list.type" ng-options="option.id as option.value for option in posts_id_type_simple"></select> </div> <div class="field-option"><a href="javascript:;" ng-click="delRecommend($index)">删除</a></div> </div> </div> </div> </div> </form> <form class="app-form" ng-init="headerIconInit()" id="headerSetting" ng-if="option.formData.type == 10"> <div class="form-content"> <div class="field" ng-class="{ \'error\' : formError.name!=0}"> <div class="name">按钮名称</div> <div class="value"> <div class="input-text"><input type="text" ng-model="option.formData.data.name" name="btnName"></div> <div class="form-tips">0~3个字，如果包含按钮名称，则图标将不会显示</div> <div class="form-error">{{error_msg.name}}</div> </div> </div> <div class="field"> <div class="name">按钮图标</div> <div class="value"> <theme-icon option="themeIcon" value="option.formData.data.icon_type"></theme-icon> </div> </div> <div class="field"> <div class="name">视图类型</div> <div class="value"> <select ng-required="1" name="btn_list" ng-model="option.formData.data.view_type" id="btn_list" ng-options="option.id as option.name for option in viewSelectList"></select> </div> </div> </div> </form> </section> <footer class="set-footer"> <div class="btn-bar"> <div class="btn btn-submit" ng-click="confirm()">确定</div> <div class="btn btn-grey" ng-click="cancel()">取消</div> </div> </footer> </div> </app-dialog> </div>'),a.put("views/directives/theme_icon.html",'<div class="select-icon"> <div class="current-icon"> <div class="theme-icon" ng-click="callList()" ng-style="value | themeIconConvert:36:option.prefix"></div> <div class="theme-icon-content" ng-if="listShow"> <ul ng-repeat="type in iconList"> <li ng-repeat="list in type track by $index" ng-click="selectIcon(list.id)"><div data-id="{{list.id}}" class="theme-icon" ng-style="list.value"></div></li> </ul> </div> </div> </div>'),a.put("views/directives/upload_img.html",'<div class="btn btn-img-upload" ng-class="{ \'had-img\' : !!src} "> <div class="">{{btnName}}</div> <input type="file" id="{{fileId}}"> <input type="text" hidden ng-model="src"> </div>'),a.put("views/frame/header.html",'<header id="header"> <div class="header"> <div class="logo"></div> <nav class="menu"> <ul> <li> <h2><a href="#/">APP设计器</a></h2> </li> <li> <h2>全局设置</h2> <dl> <dd><a href="#/style-setting">样式设置</a></dd> </dl> </li> <li> <h2><a ng-href="{{baseInfo.url.appPack}}">APP打包</a></h2> </li> </ul> </nav> </div> </header>'),a.put("views/frame/phone-preview.html",'<div> <header class="app-header" ng-class="{\'head-style-search\':preview.id==6,\'head-style-back\':preview.id==4,\'head-style-post\':preview.id==3}"> <h2 ng-if="preview.id==4">站内信</h2> <h2 ng-if="preview.id==3">发新帖</h2> <h2 ng-if="preview.id==2">论坛</h2> <h2 ng-if="preview.tab_type != 3 || preview.use_wap_name != 1 && preview.id > 9">{{preview.title}}</h2> <h2 ng-if="preview.tab_type == 3 && preview.use_wap_name == 1">使用WAP页面标题</h2> <div class="header-icon"><div class="theme-icon" ng-style="list.icon_type | themeIconConvert:20:\'nav_\'" ng-repeat="list in preview.title_cfg"></div></div> </header> <section class="app-content"> <div class="tab-design" ng-if="(preview.id>10 || preview.id<2) && preview.tab_type == 1"> <div ng-if="preview.tab_type == 1 && preview.home_page[0].enable == 1" class="design-module design-focus"><img ng-src="{{staticBasePath}}images/preview/focus.jpg" alt=""></div> <div ng-if="preview.tab_type == 1 && preview.home_page[1].enable == 1" class="design-module design-ctrl"><img ng-src="{{staticBasePath}}images/preview/ctrl.jpg" alt=""></div> <div ng-if="preview.tab_type == 1 && preview.home_page[2].enable == 1" class="design-module design-hot"><img ng-src="{{staticBasePath}}images/preview/hot.jpg" alt=""></div> <div ng-if="preview.tab_type == 1 && preview.home_page[3].enable == 1" class="design-module design-recommend"><img ng-src="{{staticBasePath}}images/preview/recommend.jpg" alt=""></div> </div> <div ng-if="(preview.id>10 || preview.id<2) && preview.tab_type == 2"> <img ng-src="{{staticBasePath}}images/preview/guide.png" alt=""> </div> <div ng-if="preview.id == 2"> <img ng-src="{{staticBasePath}}images/preview/block_1.png" alt=""> </div> <div ng-if="preview.id == 3"> <img ng-src="{{staticBasePath}}images/preview/post.png" alt=""> </div> <div ng-if="preview.id == 4"> <img ng-src="{{staticBasePath}}images/preview/message.png" alt=""> </div> <div ng-if="preview.id == 5"> <img ng-src="{{staticBasePath}}images/preview/my.png" alt=""> </div> </section> </div>'),
a.put("views/main.html",'<div id="designContent" ng-class="{\'design-guide\' : guide.show}" ng-init="designInit()" ng-if="init"> <div ng-if="guide.show" class="layer" ng-click="guide.next()"></div> <div class="content"> <div class="app-btn-bar" ng-if="isMain" ng-class="{\'fixed\':fixed}"> <div class="btn btn-submit" ng-click="applySetting(form,skeleton_page)">应用</div> <div class="btn btn-grey" ng-click="resetSetting()">还原</div> </div> <div id="phonePreview"> <div class="preview-content"> <phone-preview preview="preview.data"></phone-preview> <footer class="app-footer" ng-class="{\'guide-step-1\': guide.nowStep == 1}"> <div class="guide-img" ng-click="guide.next()"></div> <nav ng-if="module == \'setMain\'"> <div class="nav-item" ng-class="{\'active\': $index == skeleton_page-1}" ng-click="changeTab($index)" ng-repeat="menu in skeleton track by $index"><div class="theme-icon" ng-style="menu.icon_type | themeIconConvert:20:\'\'"></div></div> </nav> <div class="nav-tips" ng-if="module == \'viewModule\'">您正在编辑自定义视图...</div> </footer> </div> <div class="phone-frame"> <div class="phone-camera"></div> <div class="phone-sound"></div> <div class="phone-home"></div> </div> </div> <div ng-if="module == \'viewModule\'" ng-include="setModule[module].src"></div> <div ng-if="module == \'viewForum\'" ng-include="setModule[module].src"></div> <div ng-if="module == \'setMain\'" ng-include="setModule[module].src"></div> </div> </div> <dialog-alert option="saveAlert"></dialog-alert>'),a.put("views/style-setting.html",'<div id="designContent"> <div class="content"> <div class="app-btn-bar" ng-class="{\'fixed\':fixed}"> <div class="btn btn-submit" ng-click="applySetting()">应用</div> </div> <div id="designSetting" class="set-container full"> <header class="set-title"><h2>界面设置</h2></header> <section class="set-content"> <form class="app-form set-style" name="setStyle"> <div class="form-content"> <div class="field"> <div class="name">主题列表样式</div> <div class="value"> <div class="select-forum"> <label> <input name="threadlist_image_mode" ng-model="form.threadlist_image_mode" value="1" type="radio"> <span>多图</span> <img ng-src="{{staticBasePath}}images/preview/style-img1.jpg" alt=""> </label> <label> <input name="threadlist_image_mode" ng-model="form.threadlist_image_mode" value="0" type="radio"> <span>无图</span> <img ng-src="{{staticBasePath}}images/preview/style-img2.jpg" alt=""> </label> </div> </div> </div> <div class="field"> <div class="name">图片优化</div> <div class="value"> <div class="select-forum"> <label> <input name="enable_pic_opt" ng-model="form.enable_pic_opt" value="1" type="radio"> <span>是</span> </label> <label> <input name="enable_pic_opt" ng-model="form.enable_pic_opt" value="0" type="radio"> <span>否</span> </label> </div> <div class="form-tips">开启后，主题列表中将会展示内容摘要和图片缩略图</div> </div> </div> <div class="field"> <div class="name">回复按钮样式</div> <div class="value"> <div class="select-forum"> <label> <input name="reply_button_type" ng-model="form.reply_button_type" value="0" type="radio"> <span>普通按钮样式</span> <img ng-src="{{staticBasePath}}images/preview/style-reply1.jpg" alt=""> </label> <label> <input name="reply_button_type" ng-model="form.reply_button_type" value="1" type="radio"> <span>经典聊天样式</span> <img ng-src="{{staticBasePath}}images/preview/style-reply2.jpg" alt=""> </label> </div> </div> </div> </div> </form> </section> </div> </div> </div> <dialog-alert option="saveAlert"></dialog-alert>'),a.put("views/view-bbs.html",'<div id="designSetting" class="set-container" ng-init="viewInit()" ng-controller="ViewBBSCtrl"> <header class="set-title"><h2>版块视图</h2></header> <section class="set-content" ng-if="ready"> <form class="app-form set-form" name="setForm"> <div class="form-content"> <div class="field" ng-class="{ \'error\' : formError.name!=0}"> <div class="name">版块白名单</div> <div class="value"> <div class="input-text"><input type="text" ng-model="form.displayid" name="displayid"></div> <div class="form-tips">多个版块ID可以用","分隔，若填写了白名单，则移动端版块列表以及版块详情页面中将只会展现白名单ID对应的版块</div> <div class="form-error">{{error_msg.name}}</div> </div> </div> <div class="field"> <div class="name">版块黑名单</div> <div class="value"> <div class="input-text"><input type="text" ng-model="form.forbiddenid" name="btnName"></div> <div class="form-tips">多个版块ID可以用","分隔，若填写了黑名单，则移动端版块列表以及版块详情页面中将不会展现黑名单ID对应的版块</div> <div class="form-error">{{error_msg.name}}</div> </div> </div> <div class="field"> <div class="name">版块展示方式</div> <div class="value"> <div class="select-forum"> <label> <input name="type" ng-model="form.type" value="1" type="radio"> <span>平铺模式</span> <img ng-src="{{staticBasePath}}images/preview/bbs-type1.jpg" alt=""> </label> <label> <input name="type" ng-model="form.type" value="2" type="radio"> <span>顶部滑块</span> <img ng-src="{{staticBasePath}}images/preview/bbs-type2.jpg" alt=""> </label> <label> <input name="type" ng-model="form.type" value="3" type="radio"> <span>侧边分类</span> <img ng-src="{{staticBasePath}}images/preview/bbs-type3.jpg" alt=""> </label> </div> </div> </div> </div> </form> </section> <footer class="set-footer"> <div class="btn-bar"> <div class="btn btn-submit" ng-click="save(form)">保存视图</div> <div class="btn btn-grey" ng-click="cancel()">取消编辑</div> </div> </footer> </div>'),a.put("views/view-forum.html",'<div id="designSetting" class="set-container" ng-controller="ViewForumCtrl"> <header class="set-title"><h2>版块视图</h2></header> <section class="set-content"> <form class="app-form set-form" name="setForm"> <div class="form-content"> <div class="field" ng-class="{ \'error\' : formError.displayid!=0}"> <div class="name">版块白名单</div> <div class="value"> <div class="input-text"><input type="text" ng-pattern="/^[0-9,]+$/" ng-model="form.displayid" name="displayid"></div> <div class="form-tips">多个版块ID可以用","分隔，若填写了白名单，则移动端版块列表以及版块详情页面中将只会展现白名单ID对应的版块</div> <div class="form-error">{{error_msg.displayid}}</div> </div> </div> <div class="field" ng-class="{ \'error\' : formError.forbiddenid!=0}"> <div class="name">版块黑名单</div> <div class="value"> <div class="input-text"><input type="text" ng-pattern="/^[0-9,]+$/" ng-model="form.forbiddenid" name="btnName"></div> <div class="form-tips">多个版块ID可以用","分隔，若填写了黑名单，则移动端版块列表以及版块详情页面中将不会展现黑名单ID对应的版块</div> <div class="form-error">{{error_msg.forbiddenid}}</div> </div> </div> <div class="field"> <div class="name">版块展示方式</div> <div class="value"> <div class="select-forum"> <label> <input name="type" ng-model="form.type" value="1" type="radio"> <span>平铺模式</span> <img ng-src="{{staticBasePath}}images/preview/bbs-type1.jpg" alt=""> </label> <label> <input name="type" ng-model="form.type" value="2" type="radio"> <span>顶部滑块</span> <img ng-src="{{staticBasePath}}images/preview/bbs-type2.jpg" alt=""> </label> <label> <input name="type" ng-model="form.type" value="3" type="radio"> <span>侧边分类</span> <img ng-src="{{staticBasePath}}images/preview/bbs-type3.jpg" alt=""> </label> </div> </div> </div> </div> </form> </section> <footer class="set-footer"> <div class="btn-bar"> <div class="btn btn-submit" ng-click="save(form)">保存视图</div> <div class="btn btn-grey" ng-click="cancel()">取消编辑</div> </div> </footer> </div>'),a.put("views/view-module.html",'<div ng-init="viewInit()" ng-controller="ViewModuleCtrl"> <div id="designSetting" class="set-container"> <header class="set-title"><h2>编辑自定义视图</h2></header> <section class="set-content" ng-if="ready"> <form class="app-form set-form" name="setForm"> <div class="form-content"> <div class="field" ng-class="{ \'error\' : formError.name!=0}"> <div class="name">视图名称</div> <div class="value"> <div class="input-text"><input type="text" ng-model="form.name" name="btnName"></div> <div class="form-tips">1~8个字</div> <div class="form-error">{{error_msg.name}}</div> </div> </div> <div class="field"> <div class="name">视图类型</div> <div class="value"> <select ng-required="1" name="tab_list" ng-model="form.tab_type" id="tab_list" ng-options="option.id as option.value for option in tab_list"></select> </div> </div> <div class="form-content" ng-init="menuInit()"> <div class="field"> <div class="name">标题栏设置</div> <div class="value"> <div class="form-content header-setting"> <div class="field" ng-class="{ \'error\' : formError.title!=0}"> <div class="name">自定义标题：</div> <div class="value"> <div ng-if="form.tab_type != 3 || form.use_wap_name != 1" class="input-text"><input type="text" ng-model="form.title" name="title"></div> <div ng-if="form.tab_type != 3 || form.use_wap_name != 1" class="form-tips">0~6个字</div> <div class="form-error">{{error_msg.title}}</div> <label ng-if="form.tab_type == 3" class="checkbox"><input type="checkbox" ng-model="form.use_wap_name" ng-true-value="\'1\'" ng-false-value="\'0\'"> <span>使用WAP页面标题</span></label> </div> </div> <div class="field" ng-class="{ \'error\' : formError.name!=0}"> <div class="name">自定义按钮：</div> <div class="value"> <div class="add-header-icon" ng-class="{\'add\':form.title_cfg[1].icon_type==\'\'}"><i ng-click="callHeaderSetting(form.title_cfg[1])" ng-class="{\'theme-icon\':form.title_cfg[1].icon_type!=\'\'}" ng-style="form.title_cfg[1].icon_type | themeIconConvert:34:\'nav_\'"></i><div class="item-ctrl" ng-if="form.title_cfg[1].icon_type!=\'\'"><span ng-click="callHeaderSetting(form.title_cfg[1])" class="ctrl-icon ctrl-icon-edit"></span><span ng-click="delHeaderIcon(1)" class="ctrl-icon ctrl-icon-del"></span></div></div> <div class="add-header-icon" ng-class="{\'add\':form.title_cfg[0].icon_type==\'\'}"><i ng-click="callHeaderSetting(form.title_cfg[0])" ng-class="{\'theme-icon\':form.title_cfg[0].icon_type!=\'\'}" ng-style="form.title_cfg[0].icon_type | themeIconConvert:34:\'nav_\'"></i><div class="item-ctrl" ng-if="form.title_cfg[0].icon_type!=\'\'"><span ng-click="callHeaderSetting(form.title_cfg[0])" class="ctrl-icon ctrl-icon-edit"></span><span ng-click="delHeaderIcon(0)" class="ctrl-icon ctrl-icon-del"></span></div></div> </div> </div> <div class="hr"></div> <div class="field" ng-class="{ \'error\' : formError.name!=0}"> <div class="name">标题栏示例：</div> <div class="value"> <img src="{{staticBasePath}}images/preview/header.png" alt=""> </div> </div> </div> </div> </div> </div> <div class="form-content" ng-if="form.tab_type == 1"> <div class="field"> <div class="name">焦点图设置</div> <div class="value"> <div class="btn btn-submit" ng-click="callSetting(form.home_page[0])">设置</div> <label class="checkbox ml10"><input type="checkbox" ng-model="form.home_page[0].enable" ng-true-value="\'1\'" ng-false-value="\'0\'"> <span>显示</span></label> <span>当前配置：{{form.home_page[0].setting.length}}</span> <span>当前启动：{{getSettingEnable(form.home_page[0].setting)}}</span> </div> </div> <div class="field"> <div class="name">功能区设置</div> <div class="value"> <div class="btn btn-submit" ng-click="callSetting(form.home_page[1])">设置</div> <label class="checkbox ml10"><input type="checkbox" ng-model="form.home_page[1].enable" ng-true-value="\'1\'" ng-false-value="\'0\'"> <span>显示</span></label> <span>当前配置：{{form.home_page[1].setting.length}}</span> <span>当前启动：{{getSettingEnable(form.home_page[1].setting)}}</span> </div> </div> <div class="field"> <div class="name">热门区设置</div> <div class="value"> <div class="btn btn-submit" ng-click="callSetting(form.home_page[2])">设置</div> <label class="checkbox ml10"><input type="checkbox" ng-model="form.home_page[2].enable" ng-true-value="\'1\'" ng-false-value="\'0\'"> <span>显示</span></label> <span>当前配置：{{form.home_page[2].setting.length}}</span> <span>当前启动：{{getSettingEnable(form.home_page[2].setting)}}</span> </div> </div> <div class="field"> <div class="name">推荐区设置</div> <div class="value"> <div class="btn btn-submit" ng-click="callSetting(form.home_page[3])">设置</div> <label class="checkbox ml10"><input type="checkbox" ng-model="form.home_page[3].enable" ng-true-value="\'1\'" ng-false-value="\'0\'"> <span>显示</span></label> </div> </div> </div> <div class="form-content" ng-init="menuInit()" ng-if="form.tab_type == 2"> <div class="field"> <div class="name">导航设置</div> <div class="value"> <div class="set-menu-label"> <div class="btn btn-add-item" ng-click="addMenu()">添加导航项</div> </div> </div> </div> <div class="set-menu"> <header class="set-menu-title"> <div class="menu-order">导航排序</div> </header> <div class="menu-list"> <div class="item" ng-init="menuItemInit(list.id , $index)" ng-class="{\'item-error\':checkMenuItem($index)}" ng-repeat="list in form.navi_page.navi track by $index"> <div class="item-label"> <h3>导航顺序</h3> <input type="text" class="order-num" ng-pattern="/^\\d{1,3}$/" ng-model="list.order" min="0"> <div class="trigger-edit" ng-click="editMenu($index)"></div> </div> <div class="form-content"> <div class="field"> <div class="name">显示该版块</div> <div class="value"> <label class="checkbox"><input type="checkbox" ng-model="list.flag" ng-true-value="\'1\'" ng-false-value="\'0\'"> <span>显示</span></label> </div> </div> <div class="field" ng-class="{ \'error\' : navFormError[$index].navi_name !=0 }"> <div class="name">导航名称(必填)</div> <div class="value"> <div class="input-text"> <input type="text" ng-model="list.navi_name" name="navi_name"> </div> <div class="form-error">{{navError_msg.navi_name}}</div> </div> </div> </div> <div class="form-content" ng-if="form.navi_page.selected-1 == $index"> <div class="field"> <div class="name">导航项类型</div> <div class="value"> <select ng-required="1" name="nav_tab_list" ng-model="list.navi_setting.tab_type" id="nav_tab_list" ng-options="option.id as option.value for option in nav_tab_list"></select> </div> </div> <div class="form-content" ng-if="list.navi_setting.tab_type == 1"> <div class="field"> <div class="name">焦点图设置</div> <div class="value"> <div class="btn btn-submit" ng-click="callSetting(list.navi_setting.home_page[0])">设置</div> <label class="checkbox ml10"><input type="checkbox" ng-model="list.navi_setting.home_page[0].enable" ng-true-value="\'1\'" ng-false-value="\'0\'"> <span>显示</span></label> <span>当前配置：{{list.navi_setting.home_page[0].setting.length}}</span> <span>当前启动：{{getSettingEnable(list.navi_setting.home_page[0].setting)}}</span> </div> </div> <div class="field"> <div class="name">功能区设置</div> <div class="value"> <div class="btn btn-submit" ng-click="callSetting(list.navi_setting.home_page[1])">设置</div> <label class="checkbox ml10"><input type="checkbox" ng-model="list.navi_setting.home_page[1].enable" ng-true-value="\'1\'" ng-false-value="\'0\'"> <span>显示</span></label> <span>当前配置：{{list.navi_setting.home_page[1].setting.length}}</span> <span>当前启动：{{getSettingEnable(list.navi_setting.home_page[1].setting)}}</span> </div> </div> <div class="field"> <div class="name">热门区设置</div> <div class="value"> <div class="btn btn-submit" ng-click="callSetting(list.navi_setting.home_page[2])">设置</div> <label class="checkbox ml10"><input type="checkbox" ng-model="list.navi_setting.home_page[2].enable" ng-true-value="\'1\'" ng-false-value="\'0\'"> <span>显示</span></label> <span>当前配置：{{list.navi_setting.home_page[2].setting.length}}</span> <span>当前启动：{{getSettingEnable(list.navi_setting.home_page[2].setting)}}</span> </div> </div> <div class="field"> <div class="name">推荐区设置</div> <div class="value"> <div class="btn btn-submit" ng-click="callSetting(list.navi_setting.home_page[3])">设置</div> <label class="checkbox ml10"><input type="checkbox" ng-model="list.navi_setting.home_page[3].enable" ng-true-value="\'1\'" ng-false-value="\'0\'"> <span>显示</span></label> </div> </div> </div> <div class="form-content" ng-if="list.navi_setting.tab_type == 3"> <div class="field" ng-class="{ \'error\' : navFormError[$index].wap_page!=0 && form.navi_page.selected-1 == $index}"> <div class="name">WAP页面</div> <div class="value"> <div class="input-text"><input type="url" ng-model="list.navi_setting.wap_page" name="wap_page"></div> <div class="form-error">{{navError_msg.wap_page}}</div> </div> </div> </div> <footer class="set-footer"> <div class="btn-bar"> <div class="btn btn-grey" ng-click="editMenu($index)">收起</div> <div class="btn btn-grey" ng-click="delMenu($index)">删除</div> </div> </footer> </div> </div> </div> </div> </div> <div class="form-content" ng-if="form.tab_type == 3" ng-class="{ \'error\' : formError.wap_page!=0}"> <div class="field"> <div class="name">WAP页面</div> <div class="value"> <div class="input-text"><input type="url" ng-model="form.wap_page" name="wap_page"></div> <div class="form-error">{{error_msg.wap_page}}</div> </div> </div> </div> <!--<div class="field">--> <!--<div class="name">&nbsp;</div>--> <!--<div class="value">--> <!--&lt;!&ndash;<div class="btn btn-grey flr" ng-if="form.button_type == 1" ng-click="defaultSetting()">重置</div>&ndash;&gt;--> <!--</div>--> <!--</div>--> </div> </form> </section> <footer class="set-footer"> <div class="btn-bar"> <div class="btn btn-submit" ng-click="save(form)">保存视图</div> <div class="btn btn-grey" ng-click="cancel()">取消编辑</div> <!--<div class="btn btn-grey" ng-click="applySetting(form,skeleton_page)">应用</div>--> <!--<div class="btn btn-grey" ng-click="resetSetting()">还原</div>--> </div> </footer> </div> <popup-setting option="popup"></popup-setting> </div>')}]);