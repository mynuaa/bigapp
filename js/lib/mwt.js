/**
 * mwt.js (v2.3.2)
 * copyright: mawentao
 * released: 2015-03-20 14:11:32
 **/
function hide(eleid){document.getElementById(eleid).style.display ="none";}function display(eleid){document.getElementById(eleid).style.display ="block";}function json2str(o, depth){var result ='';depth || (depth=1);var indent_pre =new Array(4*(depth-1)).join(' ');var indent =new Array(4*depth).join(' ');var tmp ='';var type =typeof o;switch(type){case 'string': case 'number': case 'boolean': case 'undefined': case 'function': tmp +=o;break;case 'object': default: for(var key in o){tmp +=indent + '[' + key + '] = ';tmp +=json2str(o[key], (depth+1));}}if (type =="object"){result +=type + "\n";result +=indent_pre + '(' + "\n";result +=tmp;result +=indent_pre + ')' + "\n";}else {result +=type + "(" + tmp + ")\n";}return result;}function print_r(o){alert(json2str(o));}function get_html(eleid){return document.getElementById(eleid).innerHTML;}function get_value(eleid){var dom =document.getElementById(eleid);return dom.value.trim();}function get_int_value(eleid, dafult_value){var dom =document.getElementById(eleid);var val =parseInt(dom.value);if (isNaN(val)){dom.value =dafult_value;val =dafult_value;}return val;}function get_text_value(eleid){var dom =document.getElementById(eleid);var val =dom.value.trim();if (val ==""){dom.value ="";dom.focus();throw new Error(eleid+" is empty");}return val;}function get_textarea_values(eleid){var str =get_text_value(eleid);var arr =str.split("\n");var res =[];for (var i=0;i<arr.length;++i){var v =arr[i].trim();if (v ==""){continue;}v =encodeURIComponent(v);res.push(v);}return res;}function get_radio_value(elename){var radios =document.getElementsByName(elename);var result;for(var i=0;i<radios.length;i=i+1){if(radios[i].checked ==true){result =radios[i].value;break;}}return result;}function get_select_value(eleid){var sel =document.getElementById(eleid);return sel.options[sel.selectedIndex].value;}function get_checkbox_values(elename){var values =[];var doms =document.getElementsByName(elename);for (var i=0;i<doms.length;++i){if (doms[i].checked){values.push(doms[i].value);}}return values;}function set_html(eleid, value){document.getElementById(eleid).innerHTML =value;}function set_value(eleid, value){document.getElementById(eleid).value =value;}function set_select_value(eleid, value){var sel =document.getElementById(eleid);for(var i=0;i<sel.options.length;i=i+1){if(sel.options[i].value ==value){sel.options[i].selected =true;break;}}}function set_radio_value(elename, value){var doms =document.getElementsByName(elename);for (var i=0;i<doms.length;++i){if (doms[i].value ==value){doms[i].checked =true;return;}}}function set_checkbox_checked(elename, checked){var doms =document.getElementsByName(elename);for (var i=0;i<doms.length;++i){doms[i].checked =checked;}}function set_checkbox_values(elename, varr){var doms =document.getElementsByName(elename);for (var i=0;i<doms.length;++i){var checked =false;for (var k=0;k<varr.length;++k){if (varr[k] ==doms[i].value){checked =true;break;}}doms[i].checked =checked;}}Array.prototype.remove=function(dx){if(isNaN(dx)||dx>this.length){return false;}for(var i=0,n=0;i<this.length;i++){if(this[i]!=this[dx]){this[n++]=this[i];}}this.length-=1;};String.prototype.startWith=function(str, ignoreCase){var reg =eval("/^"+str+"/");if (ignoreCase)reg =eval("/^"+str+"/i");return reg.test(this);};String.prototype.startwith=function(str, ignoreCase){var reg =eval("/^"+str+"/");if (ignoreCase)reg =eval("/^"+str+"/i");return reg.test(this);};String.prototype.endWith=function(str, ignoreCase){var reg =eval("/"+str+"$/");if (ignoreCase)reg =eval("/"+str+"$/i");return reg.test(this);};String.prototype.endwith=function(str, ignoreCase){var reg =eval("/"+str+"$/");if (ignoreCase)reg =eval("/"+str+"$/i");return reg.test(this);};String.prototype.replaceAll=function(olds, news){return this.replace(new RegExp(olds,"gm"), news);};Date.prototype.format=function(fmt){var Y =this.getFullYear();var m =this.getMonth()+1;if (m <10)m ="0"+m;var d =this.getDate();if (d <10)d ="0"+d;var H =this.getHours();if (H <10)H ="0"+H;var i =this.getMinutes();if (i <10)i ="0"+i;var s =this.getSeconds();if (s <10)s ="0"+s;return fmt.replace(/Y/g, Y). replace(/m/g, m). replace(/d/g, d). replace(/H/g, H). replace(/i/g, i). replace(/s/g, s);};function is_number(num){var reg=/^[0-9]+$/;return reg.test(num);};function is_decimal(num){var reg=/^[0-9]+[\.]{0,1}[0-9]*$/;return reg.test(num);};function implode(str, arr){var res="";var con="";for (var i=0;i<arr.length;++i){res+=con+arr[i];con=str;}return res;};function in_array(value, arr){var len=arr.length;for (var i=0;i<len;++i)if (arr[i]==value)return true;return false;};function isset(v){return typeof(v)!="undefined";};function array_keys(o){var res=[];for (var key in o)res.push(key);return res;};var MWT={};MWT.show_loading =function(){};MWT.hide_loading =function(){};MWT.extends=function(A,B){A.prototype =new B();};MWT.Event=function(){this.listeners={};this.addListener=function(ename, func){if (!this.listeners[ename]){this.listeners[ename]=[];}for (var i=0;i<this.listeners[ename].length;++i){if (func==this.listeners[ename][i])return;}this.listeners[ename].push(func);};this.on=function(ename, func){this.addListener(ename, func);};this.fireon=function(ename, func){this.addListener(ename, func);func.call(func, this);};this.removeListener=function(ename, func){if (!this.listeners[ename]){return;}var arr=this.listeners[ename];for (var i=0;i<arr.length;++i){if (arr[i]==func){arr.remove(i);return;}}};this.un=function(ename,func){this.removeListener(ename, func);};this.removeAllListeners=function(ename){delete this.listeners[ename];};this.unall=function(ename){this.removeAllListeners(ename);};this.fireEvent=function(ename){if (!this.listeners[ename]){return;}var arr=this.listeners[ename];for (var i=0;i<arr.length;++i){var fun=arr[i];fun.call(fun, this);}};this.fire=function(ename){this.fireEvent(ename);};};MWT.Store=function(cnf){this.listeners ={};this.url="";this.baseParams={};this.totalProperty=0;this.root=[];this.annex={};if (cnf){if (cnf.url)this.url=cnf.url;}this.size=function(){return this.root.length;};this.get=function(index){return this.root[index];};this.indexOf=function(key,value){var n=this.root.length;if (typeof value=="undefined"){for (var i=0;i<n;++i)if (this.root[i]==key)return i;}else {for (var i=0;i<n;++i)if (this.root[i][key]==value)return i;}return -1;};this.push=function(item){this.root.push(item);this.fire("load");};this.insert=function(index,item){this.root.splice(index,0,item);this.fire("load");};this.remove=function(index){this.root.splice(index,1);this.fire("load");};this.pop=function(index){this.root.pop();this.fire("load");};this.clear=function(){this.root=[];this.fire("load");};this.set=function(index,item){this.root[index]=item;this.fire("load");};
this.load=function(data){
	if (data){this.root=data;this.totalProperty=data.length;this.fire("load");}else {var thiso=this;MWT.show_loading();
    jQuery.ajax({
        type: "post",
        async: false,
        url: this.url,
        data: this.baseParams,
        dataType: "json",
        success: function (res) {
            MWT.hide_loading();
            if (typeof res.data == 'undefined') {
                alert("数据返回格式错误");
            }
            thiso.totalProperty=res.data.totalProperty;
            thiso.root=res.data.root;
            if (res.annex)thiso.annex=res.data.annex;
            thiso.fire("load");
        },
        error: function (data) {
            MWT.hide_loading();
            alert("数据加载失败");
        }
    });
/*$.post(this.url, this.baseParams, function(res){
	MWT.hide_loading();
thiso.totalProperty=res.totalProperty;
thiso.root=res.root;if (res.annex)thiso.annex=res.annex;thiso.fire("load");}, "json");*/}};
this.sort=function(key, dir){this.baseParams["sort"]=key;this.baseParams["dir"] =dir;this.load();};};MWT.extends(MWT.Store, MWT.Event);MWT.Toolbar=function(){this.listeners ={};};MWT.extends(MWT.Toolbar, MWT.Event);MWT.Pagebar=function(cnf){this.listeners ={};this.store={};this.render=null;this.pageNumCount=10;this.pageSizeList=[10,20,50,100];this.start=0;this.pageSize=20;this.pageNum=0;this.pageCount=0;this.totalProperty=0;if (cnf){if (cnf.render)this.render=cnf.render;if (cnf.pageSize)this.pageSize=cnf.pageSize;if (cnf.pageSizeList)this.pageSizeList=cnf.pageSizeList;if (cnf.store){this.store=cnf.store;var thiso=this;this.store.on("load", function(s){thiso.totalProperty=s.totalProperty;thiso.pageNum=(thiso.start/thiso.pageSize)+ 1;thiso.pageCount=Math.ceil(s.totalProperty/thiso.pageSize);thiso.fire("load");thiso.display();});}}this.changePage=function(pn){var pagenumer=pn>0 ? pn-1 : 0;this.start=pagenumer * this.pageSize;this.store.baseParams["start"]=this.start;this.store.baseParams["limit"]=this.pageSize;this.store.load();};this.changePagesize=function(size){this.pageSize=size;this.changePage(1);};this.nextPage=function(){var page=this.pageNum + 1;if (page >this.pageCount){page=this.pageNum;}this.changePage(page);};this.prevPage=function(){var page=this.pageNum - 1;if (page <1){page=1;}this.changePage(page);};this.firstPage=function(){this.changePage(1);};this.lastPage=function(){this.changePage(this.pageCount);};this.display=function(){if (this.render){var thiso=this;var selid=this.render+"-sel";var code="<table class='tablay'><tr><td>";var list_heaad=[ {"text":"首页", "value":1, "active":this.pageNum!=1}, {"text":"上一页", "value":this.pageNum-1, "active":this.pageNum!=1}];var list_body=[];var step=Math.ceil(this.pageNumCount / 2);var begin=this.pageNum - step;if (begin<1)begin=1;var count=0;while (count <this.pageNumCount){var active=(begin!=this.pageNum);var item={"text":begin, "value":begin, "active":active};list_body.push(item);++begin;if (begin >this.pageCount)break;++count;}var list_tail=[ {"text":"下一页", "value":this.pageNum+1, "active":(this.pageCount>0)&(this.pageNum!=this.pageCount)}, {"text":"尾页", "value":this.pageCount, "active":(this.pageCount>0)&(this.pageNum!=this.pageCount)}];var list=list_heaad.concat(list_body, list_tail);for (var i=0;i<list.length;++i){var t=list[i].text;var v=list[i].value;var c=list[i].active ? "" : "disabled";code +="<button name='dd' "+c+" value='"+v+"' "+ "class='mwt-btn mwt-btn-default mwt-btn-xs' style='border-radius:0;margin-left:1px;'>"+t+"</button>";}code +="</td><td style='text-align:right;'>每页显示个数：<select id='"+selid+"'>";for (var i=0;i<this.pageSizeList.length;++i){var v=this.pageSizeList[i];var c=v==this.pageSize ? "selected" : "";code+="<option value='"+v+"' "+c+">"+v+"</option>";}code +="</select>";code +="</td></tr></table>";document.getElementById(this.render).innerHTML=code;document.getElementById(selid).onchange=function(e){thiso.changePagesize(this.value);};var btns=document.getElementsByName("dd");for (var i=0;i<btns.length;++i){btns[i].onclick=function(e){thiso.changePage(this.value);};}}};};MWT.extends(MWT.Pagebar, MWT.Toolbar);MWT.Dialog =function(opt){this.listeners ={};var title ="新建窗口";var dom =null;var dialog_body_id ="";var dialog_title_id ="";var dialog_content_id ="";var render ="";var width ="500px";var height ="auto";var maximizable =false;var top =100;if (opt){if (opt.title)title =opt.title;if (opt.width)width =opt.width+"px";if (opt.height)height =opt.height+"px";if (opt.maximizable)maximizable =opt.maximizable;if (opt.top)top =opt.top;render =opt.render;}this.create =function(){var eleid =render;dialog_body_id =eleid+"-dialog-body";dialog_title_id =eleid+"-dialog-title";dialog_content_id =eleid+"-dialog-content";dom =document.getElementById(eleid);dom.className ="mwt-dialog";var content_html =dom.innerHTML;var htmlcode ="<div class='modaldiv'></div>";htmlcode+="<div id='"+dialog_body_id+"' class='dialog-body'";if (maximizable)htmlcode+="style='width:100%; height:100%'>";else htmlcode+="style='width:"+width+";height:"+height+";margin-top:"+top+"px;'>";htmlcode+="<div><table class='tablay'>"+ "<tr><td class='header' id='"+dialog_title_id+"'>"+title+"</td>"+ "<td style='align:right;'>"+ "<a class='btnclose' href='javascript:hide(\""+eleid+"\")'> × </a></td></t></table></div>";htmlcode+="<div class='content' id='"+dialog_content_id+"'>"+ content_html+ "</div>"+ "</div></div>";dom.innerHTML =htmlcode;};this.open =function(){if (dom ==null){this.create();}this.fire("beforeOpen");dom.style.display ="block";this.fire("open");};this.close =function(){dom.style.display ="none";};this.setTitle =function(text){title =text;if (dom){document.getElementById(dialog_title_id).innerHTML =title;}};};MWT.extends(MWT.Dialog, MWT.Event);MWT.Form =function(opt){this.listeners ={};this.item ={};var items =[];var render =null;var formid ="";if (opt){if (opt.render){render=opt.render;formid=render+"-fm";}if (opt.items)items=opt.items;}function get_hidden_code(item){var value =item.value ? item.value : "";return "<input name='"+item.name+"' type='hidden' value='"+value+"'>";}function get_text_code(item){var style =item.style ? "style=\""+item.style+"\"" : "";var value =item.value ? item.value : "";return "<input name='"+item.name+"' type='text' class='form-control' "+style+" value='"+value+"'>";}function get_textarea_code(item){var style =item.style ? "style=\""+item.style+"\"" : "";var value =item.value ? item.value : "";return "<textarea name='"+item.name+"' class='form-control' "+style+">"+value+"</textarea>";}function get_text_value(item){var name =item.name;var formdom =document.getElementById(formid);var value =formdom[name].value.trim();formdom[name].value =value;if (value ==""){if (item.errmsg){document.getElementById(name+"-errmsg").innerHTML =item.errmsg;}formdom[name].focus();throw new Error(name+" is empty");}return value;}function reset_text_value(item){var value =item.value ? item.value : "";var formdom =document.getElementById(formid);formdom[item.name].value =value;}function set_text_value(item, record){if (record[item.name]){var formdom =document.getElementById(formid);formdom[item.name].value =record[item.name];}}function get_select_code(item){var style =item.style ? "style=\""+item.style+"\"" : "";var value =item.value ? item.value : "";var code ="<select name='"+item.name+"' class='form-control' "+style+">";for (var i=0;i<item.options.length;++i){var selected =item.options[i].value==item.value ? "selected" : "";code +="<option value='"+item.options[i].value+"' "+selected+">"+item.options[i].text+"</option>";}code +="</select>";return code;}function get_select_value(item){var formdom =document.getElementById(formid);var sel =formdom[item.name];return sel.options[sel.selectedIndex].value;}function reset_select_value(item){var formdom =document.getElementById(formid);var sel =formdom[item.name];var value =item.value;for(var i=0;i<sel.options.length;i=i+1){if(sel.options[i].value ==value){sel.options[i].selected =true;break;}}}function set_select_value(item, record){var formdom =document.getElementById(formid);var sel =formdom[item.name];var value =record[item.name];for(var i=0;i<sel.options.length;i=i+1){if(sel.options[i].value ==value){sel.options[i].selected =true;break;}}}function get_radio_code(item){var style =item.style ? "style=\""+item.style+"\"" : "";var value =item.value ? item.value : "";var code ="<div class='form-control'>";for (var i=0;i<item.options.length;++i){var checked =item.options[i].value==item.value ? "checked" : "";code +="<label class='pointer' "+style+"><input type='radio' name='"+item.name+"' "+ " value='"+item.options[i].value+"' "+checked+">"+item.options[i].text+"</label>";}code +="</div>";return code;}function get_radio_value(item){var formdom =document.getElementById(formid);var radios =formdom[item.name];for(var i=0;i<radios.length;i=i+1){if(radios[i].checked ==true){return radios[i].value;}}if (item.errmsg){document.getElementById(name+"-errmsg").innerHTML =item.errmsg;}throw new Error(item.name+" is not select");}function set_radio_value(item, record){var formdom =document.getElementById(formid);var radios =formdom[item.name];for (var i=0;i<radios.length;++i){if (radios[i].value ==record[item.name]){radios[i].checked =true;return;}}}function reset_radio_value(item){var record ={};record[item.name] =item.value;set_radio_value(item, record);}function get_checkbox_code(item){var style =item.style ? "style=\""+item.style+"\"" : "";var value =item.value ? item.value : "";var code ="<div class='form-control'>";for (var i=0;i<item.options.length;++i){var checked =item.options[i].value==item.value ? "checked" : "";code +="<label class='pointer' "+style+"><input type='checkbox' name='"+item.name+"' "+ " value='"+item.options[i].value+"' "+checked+">"+item.options[i].text+"</label>";}code +="</div>";return code;}function get_checkbox_value(item){var formdom =document.getElementById(formid);var values =get_checkbox_values(item.name);if (values.length>0){return values.join(",");}if (item.errmsg){document.getElementById(item.name+"-errmsg").innerHTML =item.errmsg;throw new Error(item.name+" is not select");}return "";}function set_checkbox_value(item, record){var formdom =document.getElementById(formid);var values =record[item.name].split(",");set_checkbox_values(item.name, values);}function reset_checkbox_value(item){var record ={};record[item.name] =item.value;set_checkbox_value(item, record);}this.create =function(){var eleid =render;var code="<form id='"+formid+"' onsubmit='return false;'>"+ "<table class='form'>";for (var i=0;i<items.length;++i){var label =items[i].label;var name =items[i].name;var type =items[i].type;if (type=="hidden"){code+=get_hidden_code(items[i]);continue;}code +="<tr><td>"+label+"</td>"+ "<td style='text-align:right'><div id='"+name+"-errmsg' class='errmsg'></div></td>"+ "<tr><td colspan='2'>";switch (type){case 'text': code+=get_text_code(items[i]);break;case 'textarea': code+=get_textarea_code(items[i]);break;case 'select': code+=get_select_code(items[i]);break;case 'radio': code+=get_radio_code(items[i]);break;case 'checkbox': code+=get_checkbox_code(items[i]);break;}code +="</td></tr>";}code +="</table></form>";document.getElementById(eleid).innerHTML =code;};this.submit =function(){this.item ={};var formdom =document.getElementById(formid);for (var i=0;i<items.length;++i){var name =items[i].name;var type =items[i].type;var dom =document.getElementById(items[i].name+"-errmsg");if(dom)dom.innerHTML ="";switch (type){case 'hidden': case 'text': case 'textarea': this.item[name] =get_text_value(items[i]);break;case 'select': this.item[name] =get_select_value(items[i]);break;case 'radio': this.item[name] =get_radio_value(items[i]);break;case 'checkbox': this.item[name] =get_checkbox_value(items[i]);break;}};this.fire("submit");};this.load =function(record){var formdom =document.getElementById(formid);for (var i=0;i<items.length;++i){var dom =document.getElementById(items[i].name+"-errmsg");if(dom)dom.innerHTML ="";switch (items[i].type){case "hidden": case "text": case "textarea": set_text_value(items[i], record);break;case "select": set_select_value(items[i], record);break;case "radio": set_radio_value(items[i], record);break;case "checkbox": set_checkbox_value(items[i], record);break;}}this.fire("load");};this.reset =function(){var formdom =document.getElementById(formid);for (var i=0;i<items.length;++i){var dom =document.getElementById(items[i].name+"-errmsg");if(dom)dom.innerHTML ="";switch (items[i].type){case "hidden": case "text": case "textarea": reset_text_value(items[i]);break;case "select": reset_select_value(items[i]);break;case "radio": reset_radio_value(items[i]);break;case "checkbox": reset_checkbox_value(items[i]);break;}}this.fire("reset");};};MWT.extends(MWT.Form, MWT.Event);MWT.Grid=function(opt){this.listeners={};this.render=null;this.store={};this.cm={};this.cls="mwt-table";if(opt){if(opt.render)this.render=opt.render;if(opt.cm)this.cm=opt.cm;if(opt.cls)this.cls=opt.cls;if(opt.store){this.store=opt.store;var thiso=this;this.store.on("load", function(s){thiso.display();});}}this.display=function(){if(!this.render){return;}var html ="<table class='"+this.cls+"'>";var columns=this.cm.getColumns();html+="<thead><tr>";var len=columns.length;for(var i=0;i<len;++i){if (columns[i].hide){continue;}var width="";if (columns[i].width){width="width='"+columns[i].width+"'";}html+="<td "+width+">"+columns[i].head+"</td>";}html+="</tr></thead>";html+="<tbody>";var size=this.store.size();for(var i=0;i<size;++i){var item=this.store.get(i);html+="<tr>";for(var c=0;c<len;++c){if (columns[c].hide){continue;}var dataidx=columns[c].dataIndex;var v =item[dataidx];if (columns[c].render){var func=columns[c].render;v =func(v,item);}var width="";if (columns[c].width){width="width='"+columns[c].width+"'";}html+="<td "+width+">"+v+"</td>";}html+="</tr>";}html+="</tbody>";html+="</table>";document.getElementById(this.render).innerHTML=html;};};MWT.extends(MWT.Grid, MWT.Event);MWT.Grid.ColumnModel=function(opt){this.columns=[];if(opt){this.columns=opt;}this.getColumns=function(){return this.columns;};};
